<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">






















<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">

<link rel="stylesheet" href="/css/main.css?v=7.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.2.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.2.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Record and Think!">
<meta property="og:type" content="website">
<meta property="og:title" content="Schwimmer&#39;s Blog">
<meta property="og:url" content="https://schwimmer.github.io/page/3/index.html">
<meta property="og:site_name" content="Schwimmer&#39;s Blog">
<meta property="og:description" content="Record and Think!">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Schwimmer&#39;s Blog">
<meta name="twitter:description" content="Record and Think!">





  
  
  <link rel="canonical" href="https://schwimmer.github.io/page/3/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Schwimmer's Blog</title>
  




  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-143240576-1"></script>
  <script>
    var host = window.location.hostname;
    if (host !== "localhost" || !true) {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-143240576-1');
    }
  </script>









  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Schwimmer's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://schwimmer.github.io/2019/07/01/机器学习/知识图谱/Neo4j使用方式/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Schwimmer">
      <meta itemprop="description" content="Record and Think!">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schwimmer's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/01/机器学习/知识图谱/Neo4j使用方式/" class="post-title-link" itemprop="url">未命名</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-01 11:55:18 / 修改时间：12:01:39" itemprop="dateCreated datePublished" datetime="2019-07-01T11:55:18+08:00">2019-07-01</time>
            </span>
          

          
            

            
          

          

          
            
            
              
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/07/01/机器学习/知识图谱/Neo4j使用方式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/07/01/机器学习/知识图谱/Neo4j使用方式/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="如何在neo4j中创建新数据库"><a href="#如何在neo4j中创建新数据库" class="headerlink" title="如何在neo4j中创建新数据库"></a>如何在neo4j中创建新数据库</h2><p>如图片中所示，默认的DB名称是<strong>Graph.db</strong>。</p>
<p><img src="/.io//pic/image-20190701115547060.png" alt="image-20190701115547060"></p>
<p>在Neo4j的文档中</p>
<blockquote>
<p>Community Edition is a fully functional edition of Neo4j, suitable for single instance deployments. It has full support for key Neo4j features, such as ACID compliance, Cypher, and programming APIs. It is ideal for learning Neo4j, for do-it-yourself projects, and for applications in small workgroups.</p>
</blockquote>
<p>所以你只有一个数据库实例。</p>
<p>需在<code>$NEO4J_HOME</code>的<code>conf</code>的目录编辑<code>neo4j.conf</code>。</p>
<p>搜寻<code>dbms.active_database=</code>，其默认值应为<code>graph.db</code>。用其他名称替换它，然后再次启动neo4j。现在，将在该目录名下创建一个新数据库。若要切换回以前的db，请重复这些步骤，只需将新值替换为<code>graph.db</code>在配置文件中。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://schwimmer.github.io/2019/07/01/机器学习/知识图谱/如何将大规模数据导入Neo4j/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Schwimmer">
      <meta itemprop="description" content="Record and Think!">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schwimmer's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/01/机器学习/知识图谱/如何将大规模数据导入Neo4j/" class="post-title-link" itemprop="url">未命名</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-01 11:30:22 / 修改时间：11:30:50" itemprop="dateCreated datePublished" datetime="2019-07-01T11:30:22+08:00">2019-07-01</time>
            </span>
          

          
            

            
          

          

          
            
            
              
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/07/01/机器学习/知识图谱/如何将大规模数据导入Neo4j/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/07/01/机器学习/知识图谱/如何将大规模数据导入Neo4j/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://paradoxlife.me/how-to-insert-bulk-data-into-neo4j" target="_blank" rel="noopener">http://paradoxlife.me/how-to-insert-bulk-data-into-neo4j</a></p>
<p>项目需要基于Neo4j开发，由于数据量较大（数千万节点），因此对当前数据插入的方法进行了分析和对比。</p>
<h2 id="常见数据插入方式概览"><a href="#常见数据插入方式概览" class="headerlink" title="常见数据插入方式概览"></a>常见数据插入方式概览</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">Neo4j Version</th>
<th style="text-align:center">Language Driver</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Community 3.0.2</td>
<td style="text-align:center">Python <a href="http://neo4j.com/developer/python/" target="_blank" rel="noopener">neo4j-driver 1.0.0</a></td>
</tr>
</tbody>
</table>
</div>
<p>目前主要有以下几种数据插入方式：</p>
<ol>
<li>Cypher CREATE 语句，为每一条数据写一个CREATE</li>
<li>Cypher <a href="http://neo4j.com/developer/guide-import-csv/#_load_csv_for_medium_sized_datasets" target="_blank" rel="noopener">LOAD CSV</a> 语句，将数据转成CSV格式，通过LOAD CSV读取数据。</li>
<li>官方提供的Java API —— <a href="http://neo4j.com/docs/java-reference/current/javadocs/org/neo4j/unsafe/batchinsert/BatchInserter.html" target="_blank" rel="noopener">Batch Inserter</a></li>
<li>大牛编写的 <a href="https://github.com/jexp/batch-import/blob/2.3/readme.md" target="_blank" rel="noopener">Batch Import</a> 工具</li>
<li>官方提供的 <a href="http://neo4j.com/developer/guide-import-csv/#_super_fast_batch_importer_for_huge_datasets" target="_blank" rel="noopener">neo4j-import</a> 工具</li>
</ol>
<p>这些工具有什么不同呢？速度如何？适用的场景分别是什么？我这里根据我个人理解，粗略地给出了一个结果：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">CREATE语句</th>
<th style="text-align:center">LOAD CSV语句</th>
<th style="text-align:center">Batch Inserter</th>
<th style="text-align:center">Batch Import</th>
<th style="text-align:center">Neo4j-import</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">适用场景</td>
<td style="text-align:center">1 ~ 1w nodes</td>
<td style="text-align:center">1w ~ 10 w nodes</td>
<td style="text-align:center">千万以上 nodes</td>
<td style="text-align:center">千万以上 nodes</td>
<td style="text-align:center">千万以上 nodes</td>
</tr>
<tr>
<td style="text-align:center">速度</td>
<td style="text-align:center">很慢 (1000 nodes/s)</td>
<td style="text-align:center">一般 (5000 nodes/s)</td>
<td style="text-align:center">非常快 (数万 nodes/s)</td>
<td style="text-align:center">非常快 (数万 nodes/s)</td>
<td style="text-align:center">非常快 (数万 nodes/s)</td>
</tr>
<tr>
<td style="text-align:center">优点</td>
<td style="text-align:center">使用方便，可实时插入。</td>
<td style="text-align:center">使用方便，可以加载本地/远程CSV；可实时插入。</td>
<td style="text-align:center">速度相比于前两个，有数量级的提升</td>
<td style="text-align:center">基于Batch Inserter，可以直接运行编译好的jar包；<strong>可以在已存在的数据库中导入数据</strong></td>
<td style="text-align:center">官方出品，比Batch Import占用更少的资源</td>
</tr>
<tr>
<td style="text-align:center">缺点</td>
<td style="text-align:center">速度慢</td>
<td style="text-align:center">需要将数据转换成CSV</td>
<td style="text-align:center">需要转成CSV；<strong>只能在JAVA中使用</strong>；且插入时<strong>必须停止neo4j</strong></td>
<td style="text-align:center">需要转成CSV；<strong>必须停止neo4j</strong></td>
<td style="text-align:center">需要转成CSV；<strong>必须停止neo4j</strong>；<strong>只能生成新的数据库，而不能在已存在的数据库中插入数据。</strong></td>
</tr>
</tbody>
</table>
</div>
<h2 id="速度测试"><a href="#速度测试" class="headerlink" title="速度测试"></a>速度测试</h2><p>下面是我自己做的一些性能测试：</p>
<h3 id="1-CREATE-语句"><a href="#1-CREATE-语句" class="headerlink" title="1. CREATE 语句"></a>1. CREATE 语句</h3><p>这里每1000条进行一次Transaction提交</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE (:label &#123;property1:value, property2:value, property3:value&#125; )</span><br></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">11.5w nodes</th>
<th style="text-align:center">18.5w nodes</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">100 s</td>
<td style="text-align:center">160 s</td>
</tr>
</tbody>
</table>
</div>
<h3 id="2-LOAD-CSV-语句"><a href="#2-LOAD-CSV-语句" class="headerlink" title="2. LOAD CSV 语句"></a>2. LOAD CSV 语句</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">using periodic commit 1000</span><br><span class="line">load csv from &quot;file:///fscapture_screencapture_syscall.csv&quot; as line</span><br><span class="line">create (:label &#123;a:line[1], b:line[2], c:line[3], d:line[4], e:line[5], f:line[6], g:line[7], h:line[8], i:line[9], j:line[10]&#125;)</span><br></pre></td></tr></table></figure>
<p>这里使用了语句USING PERIODIC COMMIT 1000，使得每1000行作为一次Transaction提交。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">11.5w nodes</th>
<th style="text-align:center">18.5w nodes</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">21 s</td>
<td style="text-align:center">39 s</td>
</tr>
</tbody>
</table>
</div>
<h3 id="3-Batch-Inserter、Batch-Import、Neo4j-import"><a href="#3-Batch-Inserter、Batch-Import、Neo4j-import" class="headerlink" title="3. Batch Inserter、Batch Import、Neo4j-import"></a>3. Batch Inserter、Batch Import、Neo4j-import</h3><p>我只测试了Neo4j-import，没有测试Batch Inserter和Batch Import，但是我估计他们的内部实现差不多，速度也处于一个数量级别上，因此这里就一概而论了。</p>
<p>neo4j-import需要在Neo4j所在服务器执行，因此服务器的资源影响数据导入的性能，我这里为JVM分配了16G的heap资源，确保性能达到最好。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ./bin/neo4j-import --into graph.db --nodes:label path_to_csv.csv</span><br></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">11.5w nodes</th>
<th style="text-align:center">18.5w nodes</th>
<th style="text-align:center">150w nodes + 1431w edges</th>
<th style="text-align:center">3113w nodes + 7793w edges</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">3.4 s</td>
<td style="text-align:center">3.8 s</td>
<td style="text-align:center">26.5 s</td>
<td style="text-align:center">3 m 48 s</td>
</tr>
</tbody>
</table>
</div>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><ol>
<li>如果项目刚开始，想要将大量数据导入数据库，Neo4j-import是最好的选择。</li>
<li>如果数据库已经投入使用，并且可以容忍Neo4j关闭一段时间，那么Batch Import是最好的选择，当然如果你想自己实现，那么你应该选择Batch Inserter</li>
<li>如果数据库已经投入使用，且不能容忍Neo4j的临时关闭，那么LOAD CSV是最好的选择。</li>
<li>最后，如果只是想插入少量的数据，且不怎么在乎实时性，那么请直接看Cypher语言。</li>
</ol>
<h2 id="其它的Tips"><a href="#其它的Tips" class="headerlink" title="其它的Tips"></a>其它的Tips</h2><ol>
<li>在LOAD CSV前面加上USING PERIODIC COMMIT 1000，1000表示每1000行的数据进行一次Transaction提交，提升性能。</li>
<li><a href="http://jexp.de/blog/2015/04/on-neo4j-indexes-match-merge/" target="_blank" rel="noopener">建立index</a>可以使得查询性能得到巨大提升。如果不建立index，则需要对每个node的每一个属性进行遍历，所以比较慢。 并且index建立之后，新加入的数据都会自动编入到index中。 注意index是建立在label上的，不是在node上，所以一个node有多个label，需要对每一个label都建立index。</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://schwimmer.github.io/2019/07/01/机器学习/知识图谱/cypher基本概念和语法/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Schwimmer">
      <meta itemprop="description" content="Record and Think!">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schwimmer's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/01/机器学习/知识图谱/cypher基本概念和语法/" class="post-title-link" itemprop="url">cypher基本概念和语法</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-01 09:37:21" itemprop="dateCreated datePublished" datetime="2019-07-01T09:37:21+08:00">2019-07-01</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-03 17:27:04" itemprop="dateModified" datetime="2019-07-03T17:27:04+08:00">2019-07-03</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/知识图谱/" itemprop="url" rel="index"><span itemprop="name">知识图谱</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/07/01/机器学习/知识图谱/cypher基本概念和语法/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/07/01/机器学习/知识图谱/cypher基本概念和语法/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>官方文档：<a href="https://neo4j.com/docs/cypher-refcard/3.0/" target="_blank" rel="noopener">https://neo4j.com/docs/cypher-refcard/3.0/</a></p>
<h1 id="快捷技巧"><a href="#快捷技巧" class="headerlink" title="快捷技巧"></a>快捷技巧</h1><p>结合表达式：  match(n)-[r] -(b)</p>
<pre><code>  如果查询节点n                            就    return n

  如果查询关系r                             就    return r

  如果查询节点b                            就    return b

  如果查询节点n和b之间的关系r    就    return n，r，b

  如果查询带条件                          就    where n.x = x，r.xx = xx，b.xxx = xxx

  如果修改属性                             就     where.....   set ....

  如果删除属性                             就     where.....   remove .....

  如果删除节点或关系                   就     where.....   delete n 或者 delete r  或者 delete b 或者 delete n , r , b
</code></pre><hr>
<h1 id="检索节点"><a href="#检索节点" class="headerlink" title="检索节点"></a>检索节点</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MATCH (n:Movie) RETURN n LIMIT 25</span><br><span class="line"></span><br><span class="line">// 这种查询时不限节点类型</span><br><span class="line">MATCH (tom &#123;name: &quot;冒险&quot;&#125;) RETURN tom</span><br><span class="line">MATCH (tom &#123;title: &quot;一曲凤求凰&quot;&#125;) RETURN tom</span><br><span class="line"></span><br><span class="line">// where条件</span><br><span class="line">match (p:Movie)</span><br></pre></td></tr></table></figure>
<h1 id="创建节点"><a href="#创建节点" class="headerlink" title="创建节点"></a>创建节点</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 前面这个david的部分没有意义，随便起名字</span><br><span class="line">// 属性中，最好有个叫name或者title的字段，这样在检索时会默认显示这个值。</span><br><span class="line">CREATE (david:Person &#123;name:&apos;david&apos;, borns:&apos;19869623&apos;&#125;)</span><br></pre></td></tr></table></figure>
<h1 id="建立连接"><a href="#建立连接" class="headerlink" title="建立连接"></a>建立连接</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 没有效果，为什么呢</span><br><span class="line">CREATE (david) - [:ACT_I &#123;roles:[&apos;Neo&apos;]&#125;] -&gt; (珠海三雄)</span><br><span class="line"></span><br><span class="line">// 导入数据时用的方式</span><br><span class="line">merge (from)-[r:actedin&#123;pid:toInteger(line.pid),mid:toInteger(line.mid)&#125;]-&gt;(to)</span><br></pre></td></tr></table></figure>
<h1 id="删除所有节点和关系"><a href="#删除所有节点和关系" class="headerlink" title="删除所有节点和关系"></a>删除所有节点和关系</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MATCH (n)-[r]-(b)</span><br><span class="line">DELETE n,r,b</span><br></pre></td></tr></table></figure>
<h1 id="Node语法"><a href="#Node语法" class="headerlink" title="Node语法"></a>Node语法</h1><p>在cypher里面通过用一对小括号()表示一个节点，它在cypher里面查询形式如下：</p>
<p>1，() 代表匹配任意一个节点</p>
<p>2, (node1) 代表匹配任意一个节点，并给它起了一个别名</p>
<p>3, (:Lable) 代表查询一个类型的数据</p>
<p>4, (person:Lable) 代表查询一个类型的数据，并给它起了一个别名</p>
<p>5, (person:Lable {name:”小王”}) 查询某个类型下，节点属性满足某个值的数据</p>
<p>6, (person:Lable {name:”小王”,age:23})　节点的属性可以同时存在多个，是一个AND的关系</p>
<h1 id="关系语法"><a href="#关系语法" class="headerlink" title="关系语法"></a>关系语法</h1><p>关系用一对-组成，关系分有方向的进和出，<strong>如果是无方向就是进和出都查询</strong></p>
<p>1,—&gt; 指向一个节点</p>
<p>2,-[role]-&gt; 给关系加个别名</p>
<p>3,-[:acted_in]-&gt; 访问某一类关系</p>
<p>4,-[role:acted_in]-&gt; 访问某一类关系，并加了别名</p>
<p>5,-[role:acted_in {roles:[“neo”,”hadoop”]}]-&gt;</p>
<p>访问某一类关系下的某个属性的关系的数据</p>
<h2 id="带属性的关系"><a href="#带属性的关系" class="headerlink" title="带属性的关系"></a>带属性的关系</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">match(n),(b) where n.label=&apos;科比&apos; and b.label=&apos;奥尼尔&apos;</span><br><span class="line">create(n)-[r:搭档&#123;since:1996,des:&apos;NBA史上最强OK组合&apos;,champion:3&#125;]-&gt;(b) </span><br><span class="line">return n,r,b</span><br></pre></td></tr></table></figure>
<h1 id="模式语法"><a href="#模式语法" class="headerlink" title="模式语法"></a>模式语法</h1><p>模式语法是节点和关系查询语法的结合，通过模式语法我们可以进行我们想要的任意复杂的查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 这里的Actor是什么</span><br><span class="line">(p1: Person:Actor &#123;name:&quot;tom&quot;&#125;)-[role:acted_in &#123;roles:[&quot;neo&quot;,&quot;actor&quot;]&#125;]-(m1:Movie &#123;title:&quot;water&quot;&#125;)</span><br></pre></td></tr></table></figure>
<h1 id="模式变量"><a href="#模式变量" class="headerlink" title="模式变量"></a>模式变量</h1><p>为了增加模块化和减少重复，cypher允许把模式的结果指定在一个变量或者别名中，方便后续使用或操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path = (: Person)-[:ACTED_IN]-&gt;(:Movie)</span><br></pre></td></tr></table></figure>
<p>path是结果集的抽象封装，有多个函数可以直接从path里面提取数据如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">nodes(path)：提取所有的节点</span><br><span class="line"></span><br><span class="line">rels(path): 提取所有的关系 和relationships(path)相等</span><br><span class="line"></span><br><span class="line">length(path): 获取路径长度</span><br></pre></td></tr></table></figure>
<h1 id="条件"><a href="#条件" class="headerlink" title="条件"></a>条件</h1><p>cypher语句也是由多个关键词组成，像SQL的</p>
<p>select name, count(<em>) from talbe where age=24 group by name having count(</em>) &gt;2  order by count(*) desc<br>多个关键字组成的语法，cypher也非常类似，每个关键词会执行一个特定的task来处理数据</p>
<p>match: 查询的主要关键词</p>
<p>create: 类似sql里面的insert</p>
<p>filter，project，sort，page等都有对应的功能语句</p>
<p>通过组合上面的一些语句，我们可以写出非常强大复杂的语法，来查询我们想要检索的内容，cypher会 自动解析语法并优化执行。</p>
<h1 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create (:Movie &#123;title:&quot;驴得水&quot;,released:2016&#125;) return p;</span><br></pre></td></tr></table></figure>
<p>执行成功，在neo4j的web页面我们能看到下面的信息</p>
<p>+—————————-+| No data returned. |<br>+—————————-+Nodes created: 1<br>Properties set: 2<br>Labels added: 1<br>当然cypher也可以一次创建多个数据，并同时添加关系</p>
<h1 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">match (p: Person) return p; 查询Person类型的所有数据</span><br><span class="line"></span><br><span class="line">match (p: Person &#123;name:&quot;sun&quot;&#125;) return p; 查询名字等于sun的人</span><br><span class="line"></span><br><span class="line">match( p1: Person &#123;name:&quot;sun&quot;&#125; )-[rel:friend]-&gt;(p2) return p2.name , p2.age 查询sun的朋友的名字和年龄</span><br><span class="line"></span><br><span class="line">match (old) ... create (new) create (old)-[rel:dr]-&gt;(new) return new 对已经存在的节点和新建的节点建立关系</span><br></pre></td></tr></table></figure>
<h2 id="用ID查询"><a href="#用ID查询" class="headerlink" title="用ID查询"></a>用ID查询</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 不能用n.id。这里的ID是neo4j默认的</span><br><span class="line">match(n) where ID(n) = 21798 return n</span><br></pre></td></tr></table></figure>
<h2 id="模糊查询"><a href="#模糊查询" class="headerlink" title="模糊查询"></a>模糊查询</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">match(n) where n.label=~&apos;科*.&apos; return n</span><br></pre></td></tr></table></figure>
<h1 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h1><p>merge 语法可以对已经存在的节点做改变，对变化的部分会合并</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MERGE (m:Movie &#123; title:&quot;Cloud Atlas&quot; &#125;) ON CREATE SET m.released = 2012 RETURN m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 执行以下语句没效果，没有增加realeased属性。把on CREATE去掉就可以了。</span><br><span class="line">MERGE (m:Person &#123; person_id:&quot;111&quot; &#125;) ON CREATE SET m.released = 2012 RETURN m</span><br><span class="line"></span><br><span class="line">MERGE (m:Person &#123; person_id:&quot;111&quot; &#125;) SET m.released = 2012 RETURN m</span><br></pre></td></tr></table></figure>
<p>merge …. on create set … return 语法支持合并更新</p>
<h2 id="更新属性"><a href="#更新属性" class="headerlink" title="更新属性"></a>更新属性</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">match(n) where ID(n) = 21798 set n.label=&apos;科比&apos;,n.height=198,n.position=&apos;得分后卫&apos; return n</span><br></pre></td></tr></table></figure>
<h2 id="修改关系属性"><a href="#修改关系属性" class="headerlink" title="修改关系属性"></a>修改关系属性</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">match(n)-[r]-(b) where ID(r) = 12513 set r.des=&apos;小飞侠&amp;大鲨鱼&apos; </span><br><span class="line">return n,r,b</span><br></pre></td></tr></table></figure>
<h2 id="删除属性"><a href="#删除属性" class="headerlink" title="删除属性"></a>删除属性</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">match(n) where ID(n) = 21798 remove n.height return n</span><br></pre></td></tr></table></figure>
<h2 id="删除节点"><a href="#删除节点" class="headerlink" title="删除节点"></a>删除节点</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">match(n:洛杉矶湖人) where ID(n) = 21836 delete n</span><br></pre></td></tr></table></figure>
<h2 id="删除关系"><a href="#删除关系" class="headerlink" title="删除关系"></a>删除关系</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">match(n)-[r]-(b) where n.label=&apos;科比&apos; and b.label=&apos;奥尼尔&apos;</span><br><span class="line">delete r</span><br><span class="line">return r</span><br></pre></td></tr></table></figure>
<h2 id="现有节点创建关系"><a href="#现有节点创建关系" class="headerlink" title="现有节点创建关系"></a>现有节点创建关系</h2><p><a href="https://www.quackit.com/neo4j/tutorial/neo4j_create_a_relationship_using_cypher.cfm" target="_blank" rel="noopener">https://www.quackit.com/neo4j/tutorial/neo4j_create_a_relationship_using_cypher.cfm</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MATCH (a:APP),(b:Person)</span><br><span class="line">WHERE a.app_code = &quot;F19999&quot; AND b.person_id = &quot;113&quot;</span><br><span class="line">CREATE (a)-[r:app_person]-&gt;(b)</span><br><span class="line">RETURN r</span><br></pre></td></tr></table></figure>
<h2 id="多个关系的创建"><a href="#多个关系的创建" class="headerlink" title="多个关系的创建"></a>多个关系的创建</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MATCH (a:Artist),(b:Album),(p:Person)</span><br><span class="line">WHERE a.Name = &quot;Strapping Young Lad&quot; AND b.Name = &quot;Heavy as a Really Heavy Thing&quot; AND p.Name = &quot;Devin Townsend&quot; </span><br><span class="line">CREATE (p)-[pr:PRODUCED]-&gt;(b), (p)-[pf:PERFORMED_ON]-&gt;(b), (p)-[pl:PLAYS_IN]-&gt;(a)</span><br><span class="line">RETURN a,b,p</span><br></pre></td></tr></table></figure>
<h2 id="筛选过滤"><a href="#筛选过滤" class="headerlink" title="筛选过滤"></a>筛选过滤</h2><p>cypher过滤也是用的和SQL一样的关键词where</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">match (p1: Person) where p1.name=&quot;sun&quot; return p1;</span><br></pre></td></tr></table></figure>
<p>等同下面的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">match (p1: Person &#123;name:&quot;sun&quot;&#125;) return p1</span><br></pre></td></tr></table></figure>
<p>注意where条件里面支持 and ， or ，xor，not等boolean运算符，在json串里面都是and</p>
<p>除此之外，where里面查询还支持<strong>正则查询</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">match (p1: Person)-[r:friend]-&gt;(p2: Person)</span><br><span class="line">where p1.name=~&quot;K.+&quot; or p2.age=24 or &quot;neo&quot; in r.rels</span><br><span class="line">return p1,r,p2</span><br></pre></td></tr></table></figure>
<p>关系过滤匹配使用not</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MATCH (p:Person)-[:ACTED_IN]-&gt;(m) WHERE NOT (p)-[:DIRECTED]-&gt;() RETURN p,m</span><br></pre></td></tr></table></figure>
<h2 id="结果集返回"><a href="#结果集返回" class="headerlink" title="结果集返回"></a>结果集返回</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 结果集返回做去重</span><br><span class="line">MATCH (p:Person) RETURN p, p.name AS name, upper(p.name), coalesce(p.nickname,&quot;n/a&quot;) AS nickname, &#123; name: p.name, label:head(labels(p))&#125; AS person</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">match (n) return distinct n.name;</span><br></pre></td></tr></table></figure>
<h2 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h2><p>cypher支持count,sum,avg,min,max</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">match (: Person) return count(*)</span><br></pre></td></tr></table></figure>
<p>聚合的时候null会被跳过 count 语法 支持 count( distinct role )</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MATCH (actor:Person)-[:ACTED_IN]-&gt;(movie:Movie)&lt;-[:DIRECTED]-(director:Person)RETURN actor,director,count(*) AS collaborations</span><br></pre></td></tr></table></figure>
<h2 id="排序和分页"><a href="#排序和分页" class="headerlink" title="排序和分页"></a>排序和分页</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MATCH (a:Person)-[:ACTED_IN]-&gt;(m:Movie) RETURN a,count() AS appearances ORDER BY appearances DESC SKIP 3 LIMIT 10;</span><br></pre></td></tr></table></figure>
<h2 id="收集聚合结果"><a href="#收集聚合结果" class="headerlink" title="收集聚合结果"></a>收集聚合结果</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MATCH (m:Movie)&lt;-[:ACTED_IN]-(a:Person)</span><br><span class="line">RETURN m.title AS movie, collect(a.name) AS cast, count(*) AS actors</span><br></pre></td></tr></table></figure>
<h2 id="union-联合"><a href="#union-联合" class="headerlink" title="union 联合"></a>union 联合</h2><p>支持两个查询结构集一样的结果合并</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MATCH (actor:Person)-[r:ACTED_IN]-&gt;(movie:Movie)</span><br><span class="line">RETURN actor.name AS name, type(r) AS acted_in, movie.title AS title</span><br><span class="line">UNION （ALL）</span><br><span class="line">MATCH (director:Person)-[r:DIRECTED]-&gt;(movie:Movie)</span><br><span class="line">RETURN director.name AS name, type(r) AS acted_in, movie.title AS title</span><br></pre></td></tr></table></figure>
<h2 id="with"><a href="#with" class="headerlink" title="with"></a>with</h2><p>with语句给cypher提供了强大的pipeline能力，可以一个或者query的输出，或者下一个query的输入 和return语句非常类似，唯一不同的是，with的每一个结果，必须使用别名标识。</p>
<p>通过这个功能，我们可以轻而易举的做到在查询结果里面在继续嵌套查询。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MATCH (person:Person)-[:ACTED_IN]-&gt;(m:Movie)</span><br><span class="line">WITH person, count(*) AS appearances, collect(m.title) AS movies</span><br><span class="line">WHERE appearances &gt; 1 RETURN person.name, appearances, movies</span><br></pre></td></tr></table></figure>
<p>注意在SQL里面，我们想过滤聚合结果，需要使用having语句但是在cypher里面我们可以配合with语句使用 where关键词来完成过滤</p>
<h2 id="添加约束或者索引"><a href="#添加约束或者索引" class="headerlink" title="添加约束或者索引"></a>添加约束或者索引</h2><p>唯一约束(使用merge来实现) </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE CONSTRAINT ON (movie:Movie) ASSERT movie.title IS UNIQUE</span><br></pre></td></tr></table></figure>
<p>添加索引(在图谱遍历时，快速找到开始节点),大幅提高查询遍历性能 CREATE INDEX ON :Actor(name)</p>
<p>添加测试数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE (actor:Actor &#123; name:&quot;Tom Hanks&quot; &#125;),(movie:Movie &#123; title:‘Sleepless IN Seattle‘ &#125;),</span><br><span class="line">(actor)-[:ACTED_IN]-&gt;(movie);</span><br></pre></td></tr></table></figure>
<p>使用索引查询:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MATCH (actor:Actor &#123; name: &quot;Tom Hanks&quot; &#125;) RETURN actor;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://schwimmer.github.io/2019/06/29/机器学习/知识图谱/教程-电影数据/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Schwimmer">
      <meta itemprop="description" content="Record and Think!">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schwimmer's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/29/机器学习/知识图谱/教程-电影数据/" class="post-title-link" itemprop="url">未命名</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-06-29 18:38:13" itemprop="dateCreated datePublished" datetime="2019-06-29T18:38:13+08:00">2019-06-29</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-01 16:41:13" itemprop="dateModified" datetime="2019-07-01T16:41:13+08:00">2019-07-01</time>
              </span>
            
          

          

          
            
            
              
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/06/29/机器学习/知识图谱/教程-电影数据/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/06/29/机器学习/知识图谱/教程-电影数据/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="关于数据"><a href="#关于数据" class="headerlink" title="关于数据"></a>关于数据</h1><p>执行<code>/Users/david/david/code/neo4j/movie_sample/movie_data_import.sql</code></p>
<p>表格有</p>
<p><code>genre</code>电影类型和id</p>
<p><code>movie</code>每个电影数据</p>
<p><code>movie_to_genre</code>电影和类型的映射关系</p>
<p><code>person</code>电影演员信息</p>
<p><code>person_to_movie</code>电影演员和电影的映射关系</p>
<p>2、导出CSV</p>
<p>3、导入neo4j</p>
<p>neo4j的默认导入路径是<code>/Users/david/david/neo4j-community-3.5.6/import</code></p>
<p>把csv复制到这里。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">//导入节点 电影类型  == 注意类型转换</span><br><span class="line">LOAD CSV WITH HEADERS  FROM &quot;file:///genre.csv&quot; AS line</span><br><span class="line">MERGE (p:Genre&#123;gid:toInteger(line.gid),name:line.gname&#125;)</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">//导入节点 演员信息	</span><br><span class="line">LOAD CSV WITH HEADERS FROM &apos;file:///person.csv&apos; AS line</span><br><span class="line">MERGE (p:Person &#123; pid:toInteger(line.pid),birth:line.birth,</span><br><span class="line">death:line.death,name:line.name,engname:line.engname,</span><br><span class="line">biography:line.biography,</span><br><span class="line">birthplace:line.birthplace&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 导入节点 电影信息</span><br><span class="line">LOAD CSV WITH HEADERS  FROM &quot;file:///movie.csv&quot; AS line  </span><br><span class="line">MERGE (p:Movie&#123;mid:toInteger(line.mid),title:line.title,introduction:line.introduction,</span><br><span class="line">rating:toFloat(line.rating),releasedate:line.releasedate&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 导入关系 actedin  电影是谁参演的 1对多</span><br><span class="line">LOAD CSV WITH HEADERS FROM &quot;file:///person_to_movie.csv&quot; AS line </span><br><span class="line">match (from:Person&#123;pid:toInteger(line.pid)&#125;),(to:Movie&#123;mid:toInteger(line.mid)&#125;)  </span><br><span class="line">merge (from)-[r:actedin&#123;pid:toInteger(line.pid),mid:toInteger(line.mid)&#125;]-&gt;(to)</span><br><span class="line">	</span><br><span class="line">//导入关系  电影是什么类型 == 1对多</span><br><span class="line">LOAD CSV WITH HEADERS FROM &quot;file:///movie_to_genre.csv&quot; AS line</span><br><span class="line">match (from:Movie&#123;mid:toInteger(line.mid)&#125;),(to:Genre&#123;gid:toInteger(line.gid)&#125;)  </span><br><span class="line">merge (from)-[r:is&#123;mid:toInteger(line.mid),gid:toInteger(line.gid)&#125;]-&gt;(to)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 问：章子怡都演了哪些电影？</span><br><span class="line">match(n:Person)-[:actedin]-&gt;(m:Movie) where n.name=&apos;章子怡&apos; return m.title</span><br><span class="line"></span><br><span class="line">--  删除所有的节点及关系</span><br><span class="line">MATCH (n)-[r]-(b)</span><br><span class="line">DELETE n,r,b</span><br></pre></td></tr></table></figure>
<p>导入时可能会报错</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Neo.ClientError.Statement.SemanticError: Cannot merge node using null property value for name</span><br></pre></td></tr></table></figure>
<p>可能是csv中这一列有空值，我的做法是把空值改成空格，解决。</p>
<h1 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h1><p>我们利用cypher语句查询一下关系actedin有哪些</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">match (n)-[r:actedin]-(b) return n,r,b limit 10</span><br></pre></td></tr></table></figure>
<p>参考：</p>
<p><a href="https://blog.csdn.net/Appleyk/article/details/80332911" target="_blank" rel="noopener">基于电影知识图谱的智能问答系统（二） — Neo4j导入CSV文件</a></p>
<p><a href="https://blog.csdn.net/appleyk/article/details/80331997" target="_blank" rel="noopener">基于电影知识图谱的智能问答系统（一） — Mysql数据准备</a></p>
<p><a href="https://blog.csdn.net/Appleyk/article/details/80334716" target="_blank" rel="noopener">基于电影知识图谱的智能问答系统（三） — Spark环境搭建</a></p>
<p><a href="https://blog.csdn.net/Appleyk/article/details/80335536" target="_blank" rel="noopener">基于电影知识图谱的智能问答系统（四） —HanLP分词器</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://schwimmer.github.io/2019/06/27/机器学习和深度学习算法专题/人脸识别/开源模型/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Schwimmer">
      <meta itemprop="description" content="Record and Think!">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schwimmer's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/27/机器学习和深度学习算法专题/人脸识别/开源模型/" class="post-title-link" itemprop="url">未命名</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-06-27 09:27:07 / 修改时间：09:48:27" itemprop="dateCreated datePublished" datetime="2019-06-27T09:27:07+08:00">2019-06-27</time>
            </span>
          

          
            

            
          

          

          
            
            
              
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/06/27/机器学习和深度学习算法专题/人脸识别/开源模型/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/06/27/机器学习和深度学习算法专题/人脸识别/开源模型/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>人脸验证Face Identification  / Face Verification </p>
<p>查阅开源的人脸识别技术方案，暂定使用如下三种方案：</p>
<p>​      <a href="https://github.com/cmusatyalab/openface" target="_blank" rel="noopener">https://github.com/cmusatyalab/openface</a>             基于FaceNet- A Unified Embedding for Face Recognition and Clustering</p>
<p>​     <a href="https://github.com/ageitgey/face_recognition#face-recognition" target="_blank" rel="noopener">https://github.com/ageitgey/face_recognition#face-recognition</a></p>
<p>​      <a href="https://github.com/deepinsight/insightface" target="_blank" rel="noopener">https://github.com/deepinsight/insightface</a>           基于ArcFace: Additive Angular Margin Loss for Deep Face Recognition</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://schwimmer.github.io/2019/06/26/hadoop-spark/spark/集群模式和local模式/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Schwimmer">
      <meta itemprop="description" content="Record and Think!">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schwimmer's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/26/hadoop-spark/spark/集群模式和local模式/" class="post-title-link" itemprop="url">未命名</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-06-26 17:48:32" itemprop="dateCreated datePublished" datetime="2019-06-26T17:48:32+08:00">2019-06-26</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-04 15:38:46" itemprop="dateModified" datetime="2019-07-04T15:38:46+08:00">2019-07-04</time>
              </span>
            
          

          

          
            
            
              
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/06/26/hadoop-spark/spark/集群模式和local模式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/06/26/hadoop-spark/spark/集群模式和local模式/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>local模式可用于debug</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// 集群模式</span><br><span class="line">@transient</span><br><span class="line">val conf = new SparkConf().setAppName(&quot;MetricSimilarity&quot;).set(&quot;spark.sql.shuffle.partitions&quot;, &quot;500&quot;).set(&quot;spark.default.parallelism&quot;, &quot;500&quot;).set(&quot;spark.shuffle.consolidateFiles&quot;, &quot;true&quot;)</span><br><span class="line">@transient</span><br><span class="line">val sc = new SparkContext(conf)</span><br><span class="line">@transient</span><br><span class="line">val hiveContext = new HiveContext(sc)</span><br><span class="line">hiveContext.sql(&quot;SET mapreduce.job.reduces=40&quot;)</span><br><span class="line">val hiveSql = HiveHandler.getExecuteSql(&quot;wx.trajectory.select&quot;, List(currentDateStr))</span><br><span class="line">println(hiveSql)</span><br><span class="line">val df = hiveContext.sql(hiveSql)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// local模式</span><br><span class="line">//    val conf = new SparkConf().setAppName(&quot;LocalSpark&quot;).set(&quot;spark.default.parallelism&quot;, &quot;8&quot;).setMaster(&quot;local[1]&quot;)</span><br><span class="line">//    val sc = new SparkContext(conf)</span><br><span class="line">//    val hiveContext = new HiveContext(sc)</span><br><span class="line">//    val df = readCsv(sc, &quot;/Users/david/Downloads/app_traj.csv&quot;)</span><br><span class="line"></span><br><span class="line">//读取csv，由于HUE下载的数据表头带有表名，需要去掉。例如stg_d001_t_jxl_behavior.call_cnt --&gt;&gt; call_cnt</span><br><span class="line">  def readCsv(sc:SparkContext, csvPath:String)=&#123;</span><br><span class="line">    val sqlContext = new SQLContext(sc)</span><br><span class="line">    //这里如果在csv第一行有属性的话，没有就是&quot;false&quot;</span><br><span class="line">    val dataset = sqlContext.read.format(&quot;com.databricks.spark.csv&quot;)</span><br><span class="line">      .option(&quot;header&quot;,&quot;true&quot;)</span><br><span class="line">      //.option(&quot;inferSchema&quot;,true.toString)//这是自动推断属性列的数据类型。不要打开</span><br><span class="line">      .load(csvPath)//文件的路径</span><br><span class="line">    dataset</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://schwimmer.github.io/2019/06/26/机器学习和深度学习算法专题/OPTICS/原理/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Schwimmer">
      <meta itemprop="description" content="Record and Think!">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schwimmer's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/26/机器学习和深度学习算法专题/OPTICS/原理/" class="post-title-link" itemprop="url">未命名</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-06-26 10:46:45" itemprop="dateCreated datePublished" datetime="2019-06-26T10:46:45+08:00">2019-06-26</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-06-27 09:14:39" itemprop="dateModified" datetime="2019-06-27T09:14:39+08:00">2019-06-27</time>
              </span>
            
          

          

          
            
            
              
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/06/26/机器学习和深度学习算法专题/OPTICS/原理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/06/26/机器学习和深度学习算法专题/OPTICS/原理/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://zhuanlan.zhihu.com/p/41930932" target="_blank" rel="noopener">OPTICS聚类算法</a></p>
<p>代码：<a href="https://github.com/amyxzhang/OPTICS-Automatic-Clustering" target="_blank" rel="noopener">https://github.com/amyxzhang/OPTICS-Automatic-Clustering</a></p>
<h1 id="核心距离"><a href="#核心距离" class="headerlink" title="核心距离"></a>核心距离</h1><p>给若干个邻域参数，找到满足这个参数的最小半径？</p>
<p><img src="/.io//pic/image-20190626104739769.png" alt="image-20190626104739769"></p>
<h1 id="可达距离"><a href="#可达距离" class="headerlink" title="可达距离"></a>可达距离</h1><p><img src="/.io//pic/image-20190626104940080.png" alt="image-20190626104940080"></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://schwimmer.github.io/2019/06/24/机器学习和深度学习算法专题/图算法/社区发现/文章整理/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Schwimmer">
      <meta itemprop="description" content="Record and Think!">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schwimmer's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/24/机器学习和深度学习算法专题/图算法/社区发现/文章整理/" class="post-title-link" itemprop="url">未命名</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-06-24 16:33:04 / 修改时间：16:37:39" itemprop="dateCreated datePublished" datetime="2019-06-24T16:33:04+08:00">2019-06-24</time>
            </span>
          

          
            

            
          

          

          
            
            
              
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/06/24/机器学习和深度学习算法专题/图算法/社区发现/文章整理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/06/24/机器学习和深度学习算法专题/图算法/社区发现/文章整理/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><em>Fast Unfolding</em> </p>
<p><a href="https://www.imooc.com/article/details/id/30168" target="_blank" rel="noopener"><strong>社区发现算法FastUnfolding的GraphX实现</strong></a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://schwimmer.github.io/2019/06/22/机器学习和深度学习算法专题/BP/反向传播讲解/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Schwimmer">
      <meta itemprop="description" content="Record and Think!">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schwimmer's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/22/机器学习和深度学习算法专题/BP/反向传播讲解/" class="post-title-link" itemprop="url">未命名</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-06-22 16:38:35 / 修改时间：16:43:12" itemprop="dateCreated datePublished" datetime="2019-06-22T16:38:35+08:00">2019-06-22</time>
            </span>
          

          
            

            
          

          

          
            
            
              
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/06/22/机器学习和深度学习算法专题/BP/反向传播讲解/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/06/22/机器学习和深度学习算法专题/BP/反向传播讲解/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>转自：<a href="https://blog.csdn.net/qq_32865355/article/details/80260212" target="_blank" rel="noopener">神经网络BP反向传播算法原理和详细推导流程</a></p>
<p>这篇还算讲的比较清楚的。后面我需要手动推一遍公式</p>
<p>本文的记号说明：</p>
<p><img src="/.io//pic/20180509220432642.png" alt="img"></p>
<p>下面以三层感知器(即只含有一个隐藏层的多层感知器)为例介绍“反向传播算法(BP 算法)”。</p>
<p><img src="/.io//pic/2018050922060950.png" alt="img"></p>
<p><strong>2 信息前向传播</strong></p>
<p><img src="/.io//pic/20180509220830262.png" alt="img"></p>
<h1 id="3-误差反向传播"><a href="#3-误差反向传播" class="headerlink" title="3 误差反向传播"></a>3 误差反向传播</h1><p><img src="/.io//pic/20180509221116734.png" alt="img"></p>
<p><img src="/.io//pic/20180509221204791.png" alt="img"></p>
<p><img src="/.io//pic/20180509221247739.png" alt="img"></p>
<h1 id="3-1-输出层的权重参数更新"><a href="#3-1-输出层的权重参数更新" class="headerlink" title="3.1 输出层的权重参数更新"></a>3.1 输出层的权重参数更新</h1><p><img src="/.io//pic/20180509221435900.png" alt="img"></p>
<p><img src="/.io//pic/20180509221511306.png" alt="img"></p>
<p><img src="/.io//pic/20180509221533158.png" alt="img"></p>
<h1 id="3-2-隐藏层的权重参数更新"><a href="#3-2-隐藏层的权重参数更新" class="headerlink" title="3.2  隐藏层的权重参数更新"></a>3.2  隐藏层的权重参数更新</h1><p><img src="/.io//pic/20180509221717653.png" alt="img"></p>
<p><img src="/.io//pic/2018050922180018.png" alt="img"></p>
<p><img src="/.io//pic/20180509221814447.png" alt="img"></p>
<h1 id="3-3输出层和隐藏层的偏置参数更新"><a href="#3-3输出层和隐藏层的偏置参数更新" class="headerlink" title="3.3输出层和隐藏层的偏置参数更新"></a>3.3输出层和隐藏层的偏置参数更新</h1><p><img src="/.io//pic/2018050922202053.png" alt="img"></p>
<h1 id="3-4-BP算法四个核心公式"><a href="#3-4-BP算法四个核心公式" class="headerlink" title="3.4 BP算法四个核心公式"></a>3.4 BP算法四个核心公式</h1><p><img src="/.io//pic/2018050922212487.png" alt="img"></p>
<h1 id="3-5-BP-算法计算某个训练数据的代价函数对参数的偏导数"><a href="#3-5-BP-算法计算某个训练数据的代价函数对参数的偏导数" class="headerlink" title="3.5 BP 算法计算某个训练数据的代价函数对参数的偏导数"></a>3.5 BP 算法计算某个训练数据的代价函数对参数的偏导数</h1><p><img src="/.io//pic/20180509222238953.png" alt="img"></p>
<p><img src="/.io//pic/2018050922230279.png" alt="img"></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://schwimmer.github.io/2019/06/22/深度学习笔记/Pytorch笔记/基本概念-Tensor/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Schwimmer">
      <meta itemprop="description" content="Record and Think!">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schwimmer's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/22/深度学习笔记/Pytorch笔记/基本概念-Tensor/" class="post-title-link" itemprop="url">未命名</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-06-22 10:22:44 / 修改时间：11:06:23" itemprop="dateCreated datePublished" datetime="2019-06-22T10:22:44+08:00">2019-06-22</time>
            </span>
          

          
            

            
          

          

          
            
            
              
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/06/22/深度学习笔记/Pytorch笔记/基本概念-Tensor/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/06/22/深度学习笔记/Pytorch笔记/基本概念-Tensor/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>张量操作</p>
<p>其实 torch 中 tensor 的运算和 numpy array 的如出一辙, 我们就以对比的形式来看. 如果想了解 torch 中其它更多有用的运算符, <a href="http://pytorch.org/docs/torch.html#math-operations" target="_blank" rel="noopener">API就是你要去的地方</a>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># abs 绝对值计算</span></span><br><span class="line">data = [<span class="number">-1</span>, <span class="number">-2</span>, <span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">tensor = torch.FloatTensor(data)  <span class="comment"># 转换成32位浮点 tensor</span></span><br><span class="line">print(</span><br><span class="line">    <span class="string">'\nabs'</span>,</span><br><span class="line">    <span class="string">'\nnumpy: '</span>, np.abs(data),          <span class="comment"># [1 2 1 2]</span></span><br><span class="line">    <span class="string">'\ntorch: '</span>, torch.abs(tensor)      <span class="comment"># [1 2 1 2]</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># sin   三角函数 sin</span></span><br><span class="line">print(</span><br><span class="line">    <span class="string">'\nsin'</span>,</span><br><span class="line">    <span class="string">'\nnumpy: '</span>, np.sin(data),      <span class="comment"># [-0.84147098 -0.90929743  0.84147098  0.90929743]</span></span><br><span class="line">    <span class="string">'\ntorch: '</span>, torch.sin(tensor)  <span class="comment"># [-0.8415 -0.9093  0.8415  0.9093]</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># mean  均值</span></span><br><span class="line">print(</span><br><span class="line">    <span class="string">'\nmean'</span>,</span><br><span class="line">    <span class="string">'\nnumpy: '</span>, np.mean(data),         <span class="comment"># 0.0</span></span><br><span class="line">    <span class="string">'\ntorch: '</span>, torch.mean(tensor)     <span class="comment"># 0.0</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 若obj是一个pytorch的tensor，则返回true</span></span><br><span class="line">torch.is_tensor(obj)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断obj是否是storage</span></span><br><span class="line"><span class="comment"># torch.Storage是单个数据类型的连续的一维数组，每个torch.Tensor都具有相同数据类型的相应存储。他是torch.tensor底层数据结构,他除了像Tensor一样定义数值，还可以直接把文件映射到内存中进行操作</span></span><br><span class="line">torch.is_storage(obj)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置默认的tensor的数据类型</span></span><br><span class="line">torch.set_default_tensor_type(torch.DoubleTensor)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回input张量中的元素个数</span></span><br><span class="line">torch.numel(input) -&gt; int</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置打印选项，与numpy一致</span></span><br><span class="line">torch.set_printoptions(precision=<span class="keyword">None</span>, threshold=<span class="keyword">None</span>, edgeitems=<span class="keyword">None</span>, linewidth=<span class="keyword">None</span>, profile=<span class="keyword">None</span>)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/31/">31</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Schwimmer</p>
              <div class="site-description motion-element" itemprop="description">Record and Think!</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">308</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">25</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">61</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Schwimmer</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.2.0</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="post-meta-divider">|</span>
  

  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="总访问量">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    
      <div>
        
  <script>
    window._bd_share_config = {
      "common": {
        "bdText": "",
        "bdMini": "1",
        "bdMiniList": false,
        "bdPic": ""
      },
      "image": {
        "viewList": ["tsina", "douban", "sqq", "qzone", "weixin", "twi", "fbook"],
        "viewText": "分享到：",
        "viewSize": "16"
      },
      "slide": {
        "bdImg": "5",
        "bdPos": "left",
        "bdTop": "100"
      }
    }
  </script>

<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

      </div>
    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.2.0"></script>

  <script src="/js/motion.js?v=7.2.0"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.2.0"></script>




  

  


  <script src="/js/next-boot.js?v=7.2.0"></script>


  

  

  

  
  
<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://https-schwimmer-github-io.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>







  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
  

  
  
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  

  
    
      <script type="text/x-mathjax-config">
  

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });
  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') { next = next.nextSibling }
        if (next && next.nodeName.toLowerCase() === 'br') { next.parentNode.removeChild(next) }
      }
    });
  });
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      document.getElementById(all[i].inputID + '-Frame').parentNode.className += ' has-jax';
    }
  });
</script>
<script src="//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->

    
  


  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
