<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">






















<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">

<link rel="stylesheet" href="/css/main.css?v=7.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.2.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.2.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Record and Think!">
<meta property="og:type" content="website">
<meta property="og:title" content="Schwimmer&#39;s Blog">
<meta property="og:url" content="https://schwimmer.github.io/page/3/index.html">
<meta property="og:site_name" content="Schwimmer&#39;s Blog">
<meta property="og:description" content="Record and Think!">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Schwimmer&#39;s Blog">
<meta name="twitter:description" content="Record and Think!">





  
  
  <link rel="canonical" href="https://schwimmer.github.io/page/3/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Schwimmer's Blog</title>
  




  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-143240576-1"></script>
  <script>
    var host = window.location.hostname;
    if (host !== "localhost" || !true) {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-143240576-1');
    }
  </script>









  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Schwimmer's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://schwimmer.github.io/2019/07/04/机器学习和深度学习算法专题/活体检测/活体检测解决方案-简版/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Schwimmer">
      <meta itemprop="description" content="Record and Think!">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schwimmer's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/04/机器学习和深度学习算法专题/活体检测/活体检测解决方案-简版/" class="post-title-link" itemprop="url">【转】活体检测解决方案-简版</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-04 15:14:19 / 修改时间：15:34:07" itemprop="dateCreated datePublished" datetime="2019-07-04T15:14:19+08:00">2019-07-04</time>
            </span>
          

          
            

            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/机器学习和深度学习算法理论/" itemprop="url" rel="index"><span itemprop="name">机器学习和深度学习算法理论</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/07/04/机器学习和深度学习算法专题/活体检测/活体检测解决方案-简版/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/07/04/机器学习和深度学习算法专题/活体检测/活体检测解决方案-简版/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://www.pyimagesearch.com/2019/03/11/liveness-detection-with-opencv/" target="_blank" rel="noopener">Liveness Detection with OpenCV</a></p>
<p>除了代码，还有一份计算机视觉方面的PDF文档，良心的。</p>
<p>代码下载后，在<code>/Users/david/david/code/deep_learning/image/liveness/liveness-detection-opencv.zip</code></p>
<p>PDF讲义在<code>/Users/david/david/code/deep_learning/image/liveness/cv_dl_resource_guide.pdf</code></p>
<p>www.pyimagesearch.com</p>
<p>这个网站也是专门用python深度学习实现各种人脸识别等图像算法的，推荐。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://schwimmer.github.io/2019/07/03/机器学习/知识图谱/Neo4j备份方式/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Schwimmer">
      <meta itemprop="description" content="Record and Think!">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schwimmer's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/03/机器学习/知识图谱/Neo4j备份方式/" class="post-title-link" itemprop="url">未命名</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-03 09:22:01 / 修改时间：09:22:21" itemprop="dateCreated datePublished" datetime="2019-07-03T09:22:01+08:00">2019-07-03</time>
            </span>
          

          
            

            
          

          

          
            
            
              
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/07/03/机器学习/知识图谱/Neo4j备份方式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/07/03/机器学习/知识图谱/Neo4j备份方式/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>Neo4j 企业版提供了一个在线备份（完整备份和增量备份）功能。</li>
</ul>
<p>社区版不知道</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://schwimmer.github.io/2019/07/03/机器学习/知识图谱/Neo4j单向和双向关系/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Schwimmer">
      <meta itemprop="description" content="Record and Think!">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schwimmer's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/03/机器学习/知识图谱/Neo4j单向和双向关系/" class="post-title-link" itemprop="url">未命名</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-03 09:18:02 / 修改时间：09:18:45" itemprop="dateCreated datePublished" datetime="2019-07-03T09:18:02+08:00">2019-07-03</time>
            </span>
          

          
            

            
          

          

          
            
            
              
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/07/03/机器学习/知识图谱/Neo4j单向和双向关系/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/07/03/机器学习/知识图谱/Neo4j单向和双向关系/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://www.jianshu.com/p/a25a1907b926" target="_blank" rel="noopener">https://www.jianshu.com/p/a25a1907b926</a></p>
<p>Neo4j的API允许开发人员在查询的时候<strong>完全忽略关系的方向</strong></p>
<p>比如，在Neo4j的查询语言Cypher中，查询Neo Technology的全部合作公司的语句可以大致如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MATCH (neo)-[:PARTNER]-(partner)</span><br></pre></td></tr></table></figure>
<p>查询结果会和下面两条语句执行并合并后的结果完全一致：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MATCH (neo)-[:PARTNER]-&gt;(partner)</span><br><span class="line">and MATCH (neo)&lt;-[:PARTNER]-(partner)</span><br></pre></td></tr></table></figure>
<p>因此，构建合作关系<strong>正确</strong>（至少是最有效）的方式就是用一个<strong>单向的关系</strong>，而且<strong>方向可以任意</strong>。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://schwimmer.github.io/2019/07/02/机器学习/知识图谱/图数据库Neo4j实现人脉推荐——二度人脉/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Schwimmer">
      <meta itemprop="description" content="Record and Think!">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schwimmer's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/02/机器学习/知识图谱/图数据库Neo4j实现人脉推荐——二度人脉/" class="post-title-link" itemprop="url">【转】图数据库Neo4j实现人脉推荐——二度人脉</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-02 18:14:31" itemprop="dateCreated datePublished" datetime="2019-07-02T18:14:31+08:00">2019-07-02</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-04 15:14:02" itemprop="dateModified" datetime="2019-07-04T15:14:02+08:00">2019-07-04</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/知识图谱/" itemprop="url" rel="index"><span itemprop="name">知识图谱</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/07/02/机器学习/知识图谱/图数据库Neo4j实现人脉推荐——二度人脉/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/07/02/机器学习/知识图谱/图数据库Neo4j实现人脉推荐——二度人脉/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://blog.csdn.net/LoveJavaYDJ/article/details/53491346" target="_blank" rel="noopener">https://blog.csdn.net/LoveJavaYDJ/article/details/53491346</a></p>
<p>业务需求：<br>通过现有系统“好友关系”和“用户通讯录”数据，实现人脉推荐——二度人脉….六度人脉</p>
<p>技术实现分析：<br>关系数据库（深度关联表,算死人）<br>图数据库（天然图关系，选择Neo4j）<br>业务实体模型及规模 ：<br>实体——顶点：用户（数百万）、手机号码（数亿）<br>关系——边：好友双向关系（数亿）、手机属于某个注册用户（数百万）、用户拥有手机号码（数亿）</p>
<p>事例(Neo4j中只存储关系相关数据)：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">CREATE (p1:Person &#123;uid:122622,identityType:1,personIUCode:&apos;0101&apos;&#125;)</span><br><span class="line">CREATE (p2:Person &#123;uid:122623,identityType:1,personIUCode:&apos;0201&apos;&#125;)</span><br><span class="line">CREATE (p3:Person &#123;uid:122624,identityType:2,personIUCode:&apos;0301&apos;&#125;)</span><br><span class="line"></span><br><span class="line">CREATE (m1:Mobile &#123;num:&apos;1580084xxxx&apos;&#125;)</span><br><span class="line">CREATE (m2:Mobile &#123;num:&apos;1680084xxxx&apos;&#125;)</span><br><span class="line">CREATE (m3:Mobile &#123;num:&apos;1780084xxxx&apos;&#125;)</span><br><span class="line"></span><br><span class="line">CREATE</span><br><span class="line">  /*p1分别和p2、p3互为双向好友/ </span><br><span class="line">  (p1)-[:Fellow]-&gt;(p2),</span><br><span class="line">  (p2)-[:Fellow]-&gt;(p1),</span><br><span class="line"></span><br><span class="line">  (p1)-[:Fellow]-&gt;(p3),</span><br><span class="line">  (p3)-[:Fellow]-&gt;(p1),</span><br><span class="line"></span><br><span class="line">  /*用户p1通讯录中有m1、m2、m3三个联系人/</span><br><span class="line">  (p1)-[:Has]-&gt;(m1),</span><br><span class="line">  (p1)-[:Has]-&gt;(m2),</span><br><span class="line">  (p1)-[:Has]-&gt;(m3),</span><br><span class="line"></span><br><span class="line">  (p2)-[:Has]-&gt;(m3),</span><br><span class="line"></span><br><span class="line">  /*用户p1使用手机m1注册/</span><br><span class="line">  (m1)-[:Belong]-&gt;(p1)</span><br></pre></td></tr></table></figure>
<h2 id="实施方案-amp-计划："><a href="#实施方案-amp-计划：" class="headerlink" title="实施方案&amp;计划："></a>实施方案&amp;计划：</h2><p>第一数据：</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://schwimmer.github.io/2019/07/02/hadoop-spark/spark/Spark SQL中Join常用的几种实现/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Schwimmer">
      <meta itemprop="description" content="Record and Think!">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schwimmer's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/02/hadoop-spark/spark/Spark SQL中Join常用的几种实现/" class="post-title-link" itemprop="url">未命名</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-02 09:41:56 / 修改时间：09:49:35" itemprop="dateCreated datePublished" datetime="2019-07-02T09:41:56+08:00">2019-07-02</time>
            </span>
          

          
            

            
          

          

          
            
            
              
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/07/02/hadoop-spark/spark/Spark SQL中Join常用的几种实现/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/07/02/hadoop-spark/spark/Spark SQL中Join常用的几种实现/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://www.iteblog.com/archives/2086.html" target="_blank" rel="noopener">https://www.iteblog.com/archives/2086.html</a></p>
<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>Join是SQL语句中的常用操作，良好的表结构能够将数据分散在不同的表中，使其符合某种范式，减少表冗余、更新容错等。而建立表和表之间关系的最佳方式就是Join操作。</p>
<p><a href="https://www.iteblog.com/archives/tag/spark/" target="_blank" rel="noopener">Spark</a>SQL作为大数据领域的SQL实现，自然也对Join操作做了不少优化，今天主要看一下在<a href="https://www.iteblog.com/archives/tag/spark/" target="_blank" rel="noopener">Spark</a>SQL中对于Join，常见的3种实现。</p>
<h2 id="Spark-SQL中Join常用的实现"><a href="#Spark-SQL中Join常用的实现" class="headerlink" title="Spark SQL中Join常用的实现"></a><a href="https://www.iteblog.com/archives/tag/spark/" target="_blank" rel="noopener">Spark</a> SQL中Join常用的实现</h2><h3 id="Broadcast-Join"><a href="#Broadcast-Join" class="headerlink" title="Broadcast Join"></a>Broadcast Join</h3><p>大家知道，在数据库的常见模型中（比如星型模型或者雪花模型），表一般分为两种：事实表和维度表。维度表一般指固定的、变动较少的表，例如联系人、物品种类等，一般数据有限。而事实表一般记录流水，比如销售清单等，通常随着时间的增长不断膨胀。</p>
<p>因为Join操作是对两个表中key值相同的记录进行连接，在SparkSQL中，对两个表做Join最直接的方式是先根据key分区，再在每个分区中把key值相同的记录拿出来做连接操作。但这样就不可避免地涉及到shuffle，而shuffle在Spark中是比较耗时的操作，我们应该尽可能的设计Spark应用使其避免大量的shuffle。</p>
<p>当维度表和事实表进行Join操作时，为了避免shuffle，我们可以将大小有限的维度表的全部数据分发到每个节点上，供事实表使用。executor存储维度表的全部数据，一定程度上牺牲了空间，换取shuffle操作大量的耗时，这在SparkSQL中称作Broadcast Join，如下图所示：</p>
<p><a href="https://s.iteblog.com/pic/Spark_sql_broadcast_Join_iteblog.png" target="_blank" rel="noopener"><img src="//schwimmer.github.io/2019/07/02/hadoop-spark/spark/Spark SQL中Join常用的几种实现/pic/Spark_sql_broadcast_Join_iteblog.png" alt="Broadcast Join in Apache Spark sql"></a><br>如果想及时了解Spark、Hadoop或者Hbase相关的文章，欢迎关注微信公共帐号：<strong>iteblog_hadoop</strong></p>
<p>Table B是较小的表，黑色表示将其广播到每个executor节点上，Table A的每个partition会通过block manager取到Table A的数据。根据每条记录的Join Key取到Table B中相对应的记录，根据Join Type进行操作。这个过程比较简单，不做赘述。</p>
<p>Broadcast Join的条件有以下几个：</p>
<ul>
<li>被广播的表需要小于 <code>spark.sql.autoBroadcastJoinThreshold</code> 所配置的值，默认是10M （或者加了broadcast join的hint）</li>
<li>基表不能被广播，比如 left outer join 时，只能广播左表</li>
</ul>
<p>看起来广播是一个比较理想的方案，但它有没有缺点呢？也很明显。这个方案只能用于广播较小的表，否则数据的冗余传输就远大于shuffle的开销；另外，广播时需要将被广播的表现collect到driver端，当频繁有广播出现时，对driver的内存也是一个考验。</p>
<h3 id="Shuffle-Hash-Join"><a href="#Shuffle-Hash-Join" class="headerlink" title="Shuffle Hash Join"></a>Shuffle Hash Join</h3><p>当一侧的表比较小时，我们选择将其广播出去以避免shuffle，提高性能。但因为被广播的表首先被collect到driver段，然后被冗余分发到每个executor上，所以当表比较大时，采用broadcast join会对driver端和executor端造成较大的压力。</p>
<p>但由于Spark是一个分布式的计算引擎，可以通过分区的形式将大批量的数据划分成n份较小的数据集进行并行计算。这种思想应用到Join上便是Shuffle Hash Join了。利用key相同必然分区相同的这个原理，SparkSQL将较大表的join分而治之，先将表划分成n个分区，再对两个表中相对应分区的数据分别进行Hash Join，这样即在一定程度上减少了driver广播一侧表的压力，也减少了executor端取整张被广播表的内存消耗。其原理如下图：</p>
<p><a href="https://s.iteblog.com/pic/Spark_sql_Shuffle_Hash_Join_iteblog.png" target="_blank" rel="noopener"><img src="//schwimmer.github.io/2019/07/02/hadoop-spark/spark/Spark SQL中Join常用的几种实现/pic/Spark_sql_Shuffle_Hash_Join_iteblog.png" alt="Shuffle Hash Join in Apache Spark sql"></a><br>如果想及时了解Spark、Hadoop或者Hbase相关的文章，欢迎关注微信公共帐号：<strong>iteblog_hadoop</strong></p>
<p>Shuffle Hash Join分为两步：</p>
<ul>
<li>对两张表分别按照join keys进行重分区，即shuffle，目的是为了让有相同join keys值的记录分到对应的分区中</li>
<li>对对应分区中的数据进行join，此处先将小表分区构造为一张hash表，然后根据大表分区中记录的join keys值拿出来进行匹配</li>
</ul>
<p>Shuffle Hash Join的条件有以下几个：</p>
<ul>
<li>分区的平均大小不超过spark.sql.autoBroadcastJoinThreshold所配置的值，默认是10M</li>
<li>基表不能被广播，比如left outer join时，只能广播右表</li>
<li>一侧的表要明显小于另外一侧，小的一侧将被广播（明显小于的定义为3倍小，此处为经验值）</li>
</ul>
<p>我们可以看到，在一定大小的表中，SparkSQL从时空结合的角度来看，将两个表进行重新分区，并且对小表中的分区进行hash化，从而完成join。在保持一定复杂度的基础上，尽量减少driver和executor的内存压力，提升了计算时的稳定性。</p>
<h3 id="Sort-Merge-Join"><a href="#Sort-Merge-Join" class="headerlink" title="Sort Merge Join"></a>Sort Merge Join</h3><p>上面介绍的两种实现对于一定大小的表比较适用，但当两个表都非常大时，显然无论适用哪种都会对计算内存造成很大压力。这是因为join时两者采取的都是hash join，是将一侧的数据完全加载到内存中，使用hash code取join keys值相等的记录进行连接。</p>
<p>当两个表都非常大时，SparkSQL采用了一种全新的方案来对表进行Join，即Sort Merge Join。这种实现方式不用将一侧数据全部加载后再进星hash join，但需要在join前将数据排序，如下图所示：</p>
<p><a href="https://s.iteblog.com/pic/Spark_sql_Sort_Merge_Join_iteblog.png" target="_blank" rel="noopener"><img src="//schwimmer.github.io/2019/07/02/hadoop-spark/spark/Spark SQL中Join常用的几种实现/pic/Spark_sql_Sort_Merge_Join_iteblog.png" alt="Sort Merge Join in Apache Spark sql"></a><br>如果想及时了解Spark、Hadoop或者Hbase相关的文章，欢迎关注微信公共帐号：<strong>iteblog_hadoop</strong></p>
<p>可以看到，首先将两张表按照join keys进行了重新shuffle，保证join keys值相同的记录会被分在相应的分区。分区后对每个分区内的数据进行排序，排序后再对相应的分区内的记录进行连接，如下图示：</p>
<p><a href="https://s.iteblog.com/pic/Spark_sql_Sort_Merge_Join_example_iteblog.png" target="_blank" rel="noopener"><img src="//schwimmer.github.io/2019/07/02/hadoop-spark/spark/Spark SQL中Join常用的几种实现/pic/Spark_sql_Sort_Merge_Join_example_iteblog.png" alt="Sort Merge Join in Apache Spark sql"></a><br>如果想及时了解Spark、Hadoop或者Hbase相关的文章，欢迎关注微信公共帐号：<strong>iteblog_hadoop</strong></p>
<p>看着很眼熟吧？也很简单，因为两个序列都是有序的，从头遍历，碰到key相同的就输出；如果不同，左边小就继续取左边，反之取右边。</p>
<p>可以看出，无论分区有多大，Sort Merge Join都不用把某一侧的数据全部加载到内存中，而是即用即取即丢，从而大大提升了大数据量下sql join的稳定性。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文介绍了SparkSQL中的3中Join实现，其实这也不是什么新鲜玩意儿。传统DB也有这也的玩法儿，SparkSQL只是将其做成分布式的实现。</p>
<p>本文仅仅从大的理论方面介绍了这几种实现，具体到每个join type是怎么遍历、没有join keys时应该怎么做、这些实现对join keys有什么具体的需求，这些细节都没有展现出来。感兴趣的话，可以去翻翻源码。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://schwimmer.github.io/2019/07/01/总结与思考/面试问题-BI工程师/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Schwimmer">
      <meta itemprop="description" content="Record and Think!">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schwimmer's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/01/总结与思考/面试问题-BI工程师/" class="post-title-link" itemprop="url">未命名</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-01 13:59:19" itemprop="dateCreated datePublished" datetime="2019-07-01T13:59:19+08:00">2019-07-01</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-09 09:54:44" itemprop="dateModified" datetime="2019-07-09T09:54:44+08:00">2019-07-09</time>
              </span>
            
          

          

          
            
            
              
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/07/01/总结与思考/面试问题-BI工程师/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/07/01/总结与思考/面试问题-BI工程师/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>数仓<br>1.请简单说一下过往做过的数据仓库项目，在仓库内部数据分层是如何做的，每层的出发点是什么。<br>2.说说你过往在做数据仓库过程中碰到的最大困难，你最终是是如何应对的？<br>3.星型模型和雪花模型的优劣各是什么？你日常是如何使用这两种模型的？data vault<br>4.聊聊你对于数据监控的认知和实践经验？监控的目的？监控的逻辑？监控的手段？<br>5.任务调度工具使用过哪些，你觉得里面有没有什么不顺手的地方？如果需要改进，怎么改进？如何避免环状调度依赖？</p>
<p>hive<br>1、decimal做group by<br>2、锁表问题，锁表的表现是什么？如何解决？<br>3、如果对任务资源做限制，用哪些参数？这些参数值调高调低的依据是什么<br>4、hive的数据倾斜问题。数据倾斜在任务执行时的表现是什么，你一般会从什么角度来排查数据倾斜的原因？</p>
<p>spark<br>1、spark常用的配置参数有哪些，设置某个参数值的依据是什么，如何验证你的设置<br>2、spark里，聊聊你常用的算子，哪些是Transformation类型，哪些是Action类型。<br>3、spark里，如果有一些变量要做全局告知或重复使用，该怎么做。cache和persist的区别<br>4、有没有用过spark sql。join时小表放前面。为什么？<br>5、GC的原因<br>6、数据落地后小文件过多。<br>7、并行task的数量<br>8、宽依赖、窄依赖</p>
<p>streaming<br>1、中间变量保存<br>2、如何停止<br>3、Structured streaming<br>4、SparkStreaming中的Job和Spark core的Job<br>SparkStreaming中的Job是一个应用程序，不同于Spark core中的Job。<br>从Job的的定义来看，类似于一个Java Bean，核心是其run方法，相当于Java中线程要处理的Runnable逻辑的封装。<br>Job是基于DStreams生成，更准确的说，基于DStreams的依赖关系graph来产生Jobs。<br>在Spark Streaming中以时间方式触发Job，主要采用定时方式生成，也包涵其他方式(比如状态操作state对很多Batch Duration做汇总处理)。<br>5、如何保证在遇到问题的时候数据不丢失不重复消费<br>checkpoint的最大的弊端在于，一旦你的流式程序代码或配置改变了，或者更新迭代新功能了，这个时候，你先停旧的sparkstreaming程序，然后新的程序打包编译后执行运行，会发现两种情况： （1）启动报错，反序列化异常 （2）启动正常，但是运行的代码仍然是上一次的程序的代码。</p>
<p>neo4j<br>1、分布式还是单机<br>2、数据导入怎么做<br>3、对比过其他图数据库</p>
<p>hbase<br>1、RIT(Region in Transaction)<br>2、region空洞<br>3、如何查看HFile</p>
<p>kafka问题<br>1、zookeeper的作用，可以在没有zookeeper的情况下使用kafka吗<br>2、什么是Rebalance，什么情况下会触发rebalance，consumer group怎么执行Rebalance的</p>
<p>沟通和影响力<br>1、数仓工作需要清除了解业务需求，但业务部门也有自己的工作，如果他们表现出为你解释业务问题不是很耐烦，你要怎么解决？<br>2、与业务部门沟通的时候遇到分歧，如何看待这种分歧，怎么解决？ </p>
<p>团队协作能力<br>1、是否带领团队，如何进行任务分工？你承担的是什么角色？<br>2、如果你来带领团队，你能举一个例子来说明你打算如何进行分工和项目推进吗<br>3、能否描述你在什么情况下独立工作效率最高，什么情况下你在团队中效率最高？</p>
<p>技术规划和推动能力<br>1、你觉得这个岗位需要具备哪些能力，自己目前还有什么不足？你对自己未来的发展有什么规划吗？</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://schwimmer.github.io/2019/07/01/机器学习/知识图谱/安装配置/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Schwimmer">
      <meta itemprop="description" content="Record and Think!">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schwimmer's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/01/机器学习/知识图谱/安装配置/" class="post-title-link" itemprop="url">Neo4j安装配置</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-01 12:02:12" itemprop="dateCreated datePublished" datetime="2019-07-01T12:02:12+08:00">2019-07-01</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-08 17:21:14" itemprop="dateModified" datetime="2019-07-08T17:21:14+08:00">2019-07-08</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/知识图谱/" itemprop="url" rel="index"><span itemprop="name">知识图谱</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/07/01/机器学习/知识图谱/安装配置/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/07/01/机器学习/知识图谱/安装配置/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Neo4j安装"><a href="#Neo4j安装" class="headerlink" title="Neo4j安装"></a>Neo4j安装</h1><p>下载地址<a href="https://neo4j.com/download-center/#releases" target="_blank" rel="noopener">https://neo4j.com/download-center/#releases</a></p>
<p>解压后，放在<code>/Users/david/david/neo4j-community-3.5.6</code></p>
<p>1、配置环境变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export NEO4J_HOME=&quot;/Users/david/david/neo4j-community-3.5.6&quot;</span><br><span class="line">export PATH=&quot;$NEO4J_HOME/bin:$PATH&quot;</span><br></pre></td></tr></table></figure>
<p>2、启动服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">neo4j start</span><br></pre></td></tr></table></figure>
<p>3、浏览器访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:7474/browser/</span><br></pre></td></tr></table></figure>
<p>首次进入时用户名密码都是neo4j，然后会提示输入新密码，新密码是<code>123456</code></p>
<p>重启服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">neo4j restart</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://schwimmer.github.io/2019/07/01/机器学习/知识图谱/Neo4j使用方式/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Schwimmer">
      <meta itemprop="description" content="Record and Think!">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schwimmer's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/01/机器学习/知识图谱/Neo4j使用方式/" class="post-title-link" itemprop="url">未命名</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-01 11:55:18 / 修改时间：12:01:39" itemprop="dateCreated datePublished" datetime="2019-07-01T11:55:18+08:00">2019-07-01</time>
            </span>
          

          
            

            
          

          

          
            
            
              
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/07/01/机器学习/知识图谱/Neo4j使用方式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/07/01/机器学习/知识图谱/Neo4j使用方式/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="如何在neo4j中创建新数据库"><a href="#如何在neo4j中创建新数据库" class="headerlink" title="如何在neo4j中创建新数据库"></a>如何在neo4j中创建新数据库</h2><p>如图片中所示，默认的DB名称是<strong>Graph.db</strong>。</p>
<p><img src="//schwimmer.github.io/2019/07/01/机器学习/知识图谱/Neo4j使用方式/pic/image-20190701115547060.png" alt="image-20190701115547060"></p>
<p>在Neo4j的文档中</p>
<blockquote>
<p>Community Edition is a fully functional edition of Neo4j, suitable for single instance deployments. It has full support for key Neo4j features, such as ACID compliance, Cypher, and programming APIs. It is ideal for learning Neo4j, for do-it-yourself projects, and for applications in small workgroups.</p>
</blockquote>
<p>所以你只有一个数据库实例。</p>
<p>需在<code>$NEO4J_HOME</code>的<code>conf</code>的目录编辑<code>neo4j.conf</code>。</p>
<p>搜寻<code>dbms.active_database=</code>，其默认值应为<code>graph.db</code>。用其他名称替换它，然后再次启动neo4j。现在，将在该目录名下创建一个新数据库。若要切换回以前的db，请重复这些步骤，只需将新值替换为<code>graph.db</code>在配置文件中。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://schwimmer.github.io/2019/07/01/机器学习/知识图谱/如何将大规模数据导入Neo4j/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Schwimmer">
      <meta itemprop="description" content="Record and Think!">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schwimmer's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/01/机器学习/知识图谱/如何将大规模数据导入Neo4j/" class="post-title-link" itemprop="url">【转】如何将大规模数据导入Neo4j</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-01 11:30:22" itemprop="dateCreated datePublished" datetime="2019-07-01T11:30:22+08:00">2019-07-01</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-08 17:21:55" itemprop="dateModified" datetime="2019-07-08T17:21:55+08:00">2019-07-08</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/知识图谱/" itemprop="url" rel="index"><span itemprop="name">知识图谱</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/07/01/机器学习/知识图谱/如何将大规模数据导入Neo4j/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/07/01/机器学习/知识图谱/如何将大规模数据导入Neo4j/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://paradoxlife.me/how-to-insert-bulk-data-into-neo4j" target="_blank" rel="noopener">http://paradoxlife.me/how-to-insert-bulk-data-into-neo4j</a></p>
<p>项目需要基于Neo4j开发，由于数据量较大（数千万节点），因此对当前数据插入的方法进行了分析和对比。</p>
<h2 id="常见数据插入方式概览"><a href="#常见数据插入方式概览" class="headerlink" title="常见数据插入方式概览"></a>常见数据插入方式概览</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">Neo4j Version</th>
<th style="text-align:center">Language Driver</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Community 3.0.2</td>
<td style="text-align:center">Python <a href="http://neo4j.com/developer/python/" target="_blank" rel="noopener">neo4j-driver 1.0.0</a></td>
</tr>
</tbody>
</table>
</div>
<p>目前主要有以下几种数据插入方式：</p>
<ol>
<li>Cypher CREATE 语句，为每一条数据写一个CREATE</li>
<li>Cypher <a href="http://neo4j.com/developer/guide-import-csv/#_load_csv_for_medium_sized_datasets" target="_blank" rel="noopener">LOAD CSV</a> 语句，将数据转成CSV格式，通过LOAD CSV读取数据。</li>
<li>官方提供的Java API —— <a href="http://neo4j.com/docs/java-reference/current/javadocs/org/neo4j/unsafe/batchinsert/BatchInserter.html" target="_blank" rel="noopener">Batch Inserter</a></li>
<li>大牛编写的 <a href="https://github.com/jexp/batch-import/blob/2.3/readme.md" target="_blank" rel="noopener">Batch Import</a> 工具</li>
<li>官方提供的 <a href="http://neo4j.com/developer/guide-import-csv/#_super_fast_batch_importer_for_huge_datasets" target="_blank" rel="noopener">neo4j-import</a> 工具</li>
</ol>
<p>这些工具有什么不同呢？速度如何？适用的场景分别是什么？我这里根据我个人理解，粗略地给出了一个结果：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">CREATE语句</th>
<th style="text-align:center">LOAD CSV语句</th>
<th style="text-align:center">Batch Inserter</th>
<th style="text-align:center">Batch Import</th>
<th style="text-align:center">Neo4j-import</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">适用场景</td>
<td style="text-align:center">1 ~ 1w nodes</td>
<td style="text-align:center">1w ~ 10 w nodes</td>
<td style="text-align:center">千万以上 nodes</td>
<td style="text-align:center">千万以上 nodes</td>
<td style="text-align:center">千万以上 nodes</td>
</tr>
<tr>
<td style="text-align:center">速度</td>
<td style="text-align:center">很慢 (1000 nodes/s)</td>
<td style="text-align:center">一般 (5000 nodes/s)</td>
<td style="text-align:center">非常快 (数万 nodes/s)</td>
<td style="text-align:center">非常快 (数万 nodes/s)</td>
<td style="text-align:center">非常快 (数万 nodes/s)</td>
</tr>
<tr>
<td style="text-align:center">优点</td>
<td style="text-align:center">使用方便，可实时插入。</td>
<td style="text-align:center">使用方便，可以加载本地/远程CSV；可实时插入。</td>
<td style="text-align:center">速度相比于前两个，有数量级的提升</td>
<td style="text-align:center">基于Batch Inserter，可以直接运行编译好的jar包；<strong>可以在已存在的数据库中导入数据</strong></td>
<td style="text-align:center">官方出品，比Batch Import占用更少的资源</td>
</tr>
<tr>
<td style="text-align:center">缺点</td>
<td style="text-align:center">速度慢</td>
<td style="text-align:center">需要将数据转换成CSV</td>
<td style="text-align:center">需要转成CSV；<strong>只能在JAVA中使用</strong>；且插入时<strong>必须停止neo4j</strong></td>
<td style="text-align:center">需要转成CSV；<strong>必须停止neo4j</strong></td>
<td style="text-align:center">需要转成CSV；<strong>必须停止neo4j</strong>；<strong>只能生成新的数据库，而不能在已存在的数据库中插入数据。</strong></td>
</tr>
</tbody>
</table>
</div>
<h2 id="速度测试"><a href="#速度测试" class="headerlink" title="速度测试"></a>速度测试</h2><p>下面是我自己做的一些性能测试：</p>
<h3 id="1-CREATE-语句"><a href="#1-CREATE-语句" class="headerlink" title="1. CREATE 语句"></a>1. CREATE 语句</h3><p>这里每1000条进行一次Transaction提交</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE (:label &#123;property1:value, property2:value, property3:value&#125; )</span><br></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">11.5w nodes</th>
<th style="text-align:center">18.5w nodes</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">100 s</td>
<td style="text-align:center">160 s</td>
</tr>
</tbody>
</table>
</div>
<h3 id="2-LOAD-CSV-语句"><a href="#2-LOAD-CSV-语句" class="headerlink" title="2. LOAD CSV 语句"></a>2. LOAD CSV 语句</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">using periodic commit 1000</span><br><span class="line">load csv from &quot;file:///fscapture_screencapture_syscall.csv&quot; as line</span><br><span class="line">create (:label &#123;a:line[1], b:line[2], c:line[3], d:line[4], e:line[5], f:line[6], g:line[7], h:line[8], i:line[9], j:line[10]&#125;)</span><br></pre></td></tr></table></figure>
<p>这里使用了语句USING PERIODIC COMMIT 1000，使得每1000行作为一次Transaction提交。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">11.5w nodes</th>
<th style="text-align:center">18.5w nodes</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">21 s</td>
<td style="text-align:center">39 s</td>
</tr>
</tbody>
</table>
</div>
<h3 id="3-Batch-Inserter、Batch-Import、Neo4j-import"><a href="#3-Batch-Inserter、Batch-Import、Neo4j-import" class="headerlink" title="3. Batch Inserter、Batch Import、Neo4j-import"></a>3. Batch Inserter、Batch Import、Neo4j-import</h3><p>我只测试了Neo4j-import，没有测试Batch Inserter和Batch Import，但是我估计他们的内部实现差不多，速度也处于一个数量级别上，因此这里就一概而论了。</p>
<p>neo4j-import需要在Neo4j所在服务器执行，因此服务器的资源影响数据导入的性能，我这里为JVM分配了16G的heap资源，确保性能达到最好。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ./bin/neo4j-import --into graph.db --nodes:label path_to_csv.csv</span><br></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">11.5w nodes</th>
<th style="text-align:center">18.5w nodes</th>
<th style="text-align:center">150w nodes + 1431w edges</th>
<th style="text-align:center">3113w nodes + 7793w edges</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">3.4 s</td>
<td style="text-align:center">3.8 s</td>
<td style="text-align:center">26.5 s</td>
<td style="text-align:center">3 m 48 s</td>
</tr>
</tbody>
</table>
</div>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><ol>
<li>如果项目刚开始，想要将大量数据导入数据库，Neo4j-import是最好的选择。</li>
<li>如果数据库已经投入使用，并且可以容忍Neo4j关闭一段时间，那么Batch Import是最好的选择，当然如果你想自己实现，那么你应该选择Batch Inserter</li>
<li>如果数据库已经投入使用，且不能容忍Neo4j的临时关闭，那么LOAD CSV是最好的选择。</li>
<li>最后，如果只是想插入少量的数据，且不怎么在乎实时性，那么请直接看Cypher语言。</li>
</ol>
<h2 id="其它的Tips"><a href="#其它的Tips" class="headerlink" title="其它的Tips"></a>其它的Tips</h2><ol>
<li>在LOAD CSV前面加上USING PERIODIC COMMIT 1000，1000表示每1000行的数据进行一次Transaction提交，提升性能。</li>
<li><a href="http://jexp.de/blog/2015/04/on-neo4j-indexes-match-merge/" target="_blank" rel="noopener">建立index</a>可以使得查询性能得到巨大提升。如果不建立index，则需要对每个node的每一个属性进行遍历，所以比较慢。 并且index建立之后，新加入的数据都会自动编入到index中。 注意index是建立在label上的，不是在node上，所以一个node有多个label，需要对每一个label都建立index。</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://schwimmer.github.io/2019/07/01/机器学习/知识图谱/cypher基本概念和语法/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Schwimmer">
      <meta itemprop="description" content="Record and Think!">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schwimmer's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/01/机器学习/知识图谱/cypher基本概念和语法/" class="post-title-link" itemprop="url">cypher基本概念和语法</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-01 09:37:21" itemprop="dateCreated datePublished" datetime="2019-07-01T09:37:21+08:00">2019-07-01</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-08 18:01:17" itemprop="dateModified" datetime="2019-07-08T18:01:17+08:00">2019-07-08</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/知识图谱/" itemprop="url" rel="index"><span itemprop="name">知识图谱</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/07/01/机器学习/知识图谱/cypher基本概念和语法/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/07/01/机器学习/知识图谱/cypher基本概念和语法/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>官方文档：<a href="https://neo4j.com/docs/cypher-refcard/3.0/" target="_blank" rel="noopener">https://neo4j.com/docs/cypher-refcard/3.0/</a></p>
<h1 id="快捷技巧"><a href="#快捷技巧" class="headerlink" title="快捷技巧"></a>快捷技巧</h1><p>结合表达式：  match(n)-[r] -(b)</p>
<pre><code>  如果查询节点n                            就    return n

  如果查询关系r                             就    return r

  如果查询节点b                            就    return b

  如果查询节点n和b之间的关系r    就    return n，r，b

  如果查询带条件                          就    where n.x = x，r.xx = xx，b.xxx = xxx

  如果修改属性                             就     where.....   set ....

  如果删除属性                             就     where.....   remove .....

  如果删除节点或关系                   就     where.....   delete n 或者 delete r  或者 delete b 或者 delete n , r , b
</code></pre><hr>
<h1 id="检索节点"><a href="#检索节点" class="headerlink" title="检索节点"></a>检索节点</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MATCH (n:Movie) RETURN n LIMIT 25</span><br><span class="line"></span><br><span class="line">// 这种查询时不限节点类型</span><br><span class="line">MATCH (tom &#123;name: &quot;冒险&quot;&#125;) RETURN tom</span><br><span class="line">MATCH (tom &#123;title: &quot;一曲凤求凰&quot;&#125;) RETURN tom</span><br><span class="line"></span><br><span class="line">// where条件</span><br><span class="line">match (p:Movie)</span><br></pre></td></tr></table></figure>
<h1 id="创建节点"><a href="#创建节点" class="headerlink" title="创建节点"></a>创建节点</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 前面这个david的部分没有意义，随便起名字</span><br><span class="line">// 属性中，最好有个叫name或者title的字段，这样在检索时会默认显示这个值。</span><br><span class="line">CREATE (david:Person &#123;name:&apos;david&apos;, borns:&apos;19869623&apos;&#125;)</span><br></pre></td></tr></table></figure>
<h1 id="建立连接"><a href="#建立连接" class="headerlink" title="建立连接"></a>建立连接</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 没有效果，为什么呢</span><br><span class="line">CREATE (david) - [:ACT_I &#123;roles:[&apos;Neo&apos;]&#125;] -&gt; (珠海三雄)</span><br><span class="line"></span><br><span class="line">// 导入数据时用的方式</span><br><span class="line">merge (from)-[r:actedin&#123;pid:toInteger(line.pid),mid:toInteger(line.mid)&#125;]-&gt;(to)</span><br></pre></td></tr></table></figure>
<h1 id="删除所有节点和关系"><a href="#删除所有节点和关系" class="headerlink" title="删除所有节点和关系"></a>删除所有节点和关系</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MATCH (n)-[r]-(b)</span><br><span class="line">DELETE n,r,b</span><br></pre></td></tr></table></figure>
<h1 id="Node语法"><a href="#Node语法" class="headerlink" title="Node语法"></a>Node语法</h1><p>在cypher里面通过用一对小括号()表示一个节点，它在cypher里面查询形式如下：</p>
<p>1，() 代表匹配任意一个节点</p>
<p>2, (node1) 代表匹配任意一个节点，并给它起了一个别名</p>
<p>3, (:Lable) 代表查询一个类型的数据</p>
<p>4, (person:Lable) 代表查询一个类型的数据，并给它起了一个别名</p>
<p>5, (person:Lable {name:”小王”}) 查询某个类型下，节点属性满足某个值的数据</p>
<p>6, (person:Lable {name:”小王”,age:23})　节点的属性可以同时存在多个，是一个AND的关系</p>
<h1 id="关系语法"><a href="#关系语法" class="headerlink" title="关系语法"></a>关系语法</h1><p>关系用一对-组成，关系分有方向的进和出，<strong>如果是无方向就是进和出都查询</strong></p>
<p>1,—&gt; 指向一个节点</p>
<p>2,-[role]-&gt; 给关系加个别名</p>
<p>3,-[:acted_in]-&gt; 访问某一类关系</p>
<p>4,-[role:acted_in]-&gt; 访问某一类关系，并加了别名</p>
<p>5,-[role:acted_in {roles:[“neo”,”hadoop”]}]-&gt;</p>
<p>访问某一类关系下的某个属性的关系的数据</p>
<h2 id="带属性的关系"><a href="#带属性的关系" class="headerlink" title="带属性的关系"></a>带属性的关系</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">match(n),(b) where n.label=&apos;科比&apos; and b.label=&apos;奥尼尔&apos;</span><br><span class="line">create(n)-[r:搭档&#123;since:1996,des:&apos;NBA史上最强OK组合&apos;,champion:3&#125;]-&gt;(b) </span><br><span class="line">return n,r,b</span><br></pre></td></tr></table></figure>
<h1 id="模式语法"><a href="#模式语法" class="headerlink" title="模式语法"></a>模式语法</h1><p>模式语法是节点和关系查询语法的结合，通过模式语法我们可以进行我们想要的任意复杂的查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 这里的Actor是什么</span><br><span class="line">(p1: Person:Actor &#123;name:&quot;tom&quot;&#125;)-[role:acted_in &#123;roles:[&quot;neo&quot;,&quot;actor&quot;]&#125;]-(m1:Movie &#123;title:&quot;water&quot;&#125;)</span><br></pre></td></tr></table></figure>
<h1 id="模式变量"><a href="#模式变量" class="headerlink" title="模式变量"></a>模式变量</h1><p>为了增加模块化和减少重复，cypher允许把模式的结果指定在一个变量或者别名中，方便后续使用或操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path = (: Person)-[:ACTED_IN]-&gt;(:Movie)</span><br></pre></td></tr></table></figure>
<p>path是结果集的抽象封装，有多个函数可以直接从path里面提取数据如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">nodes(path)：提取所有的节点</span><br><span class="line"></span><br><span class="line">rels(path): 提取所有的关系 和relationships(path)相等</span><br><span class="line"></span><br><span class="line">length(path): 获取路径长度</span><br></pre></td></tr></table></figure>
<h1 id="条件"><a href="#条件" class="headerlink" title="条件"></a>条件</h1><p>cypher语句也是由多个关键词组成，像SQL的</p>
<p>select name, count(<em>) from talbe where age=24 group by name having count(</em>) &gt;2  order by count(*) desc<br>多个关键字组成的语法，cypher也非常类似，每个关键词会执行一个特定的task来处理数据</p>
<p>match: 查询的主要关键词</p>
<p>create: 类似sql里面的insert</p>
<p>filter，project，sort，page等都有对应的功能语句</p>
<p>通过组合上面的一些语句，我们可以写出非常强大复杂的语法，来查询我们想要检索的内容，cypher会 自动解析语法并优化执行。</p>
<h1 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create (:Movie &#123;title:&quot;驴得水&quot;,released:2016&#125;) return p;</span><br></pre></td></tr></table></figure>
<p>执行成功，在neo4j的web页面我们能看到下面的信息</p>
<p>+—————————-+| No data returned. |<br>+—————————-+Nodes created: 1<br>Properties set: 2<br>Labels added: 1<br>当然cypher也可以一次创建多个数据，并同时添加关系</p>
<h1 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">match (p: Person) return p; 查询Person类型的所有数据</span><br><span class="line"></span><br><span class="line">match (p: Person &#123;name:&quot;sun&quot;&#125;) return p; 查询名字等于sun的人</span><br><span class="line"></span><br><span class="line">match( p1: Person &#123;name:&quot;sun&quot;&#125; )-[rel:friend]-&gt;(p2) return p2.name , p2.age 查询sun的朋友的名字和年龄</span><br><span class="line"></span><br><span class="line">match (old) ... create (new) create (old)-[rel:dr]-&gt;(new) return new 对已经存在的节点和新建的节点建立关系</span><br></pre></td></tr></table></figure>
<h2 id="用ID查询"><a href="#用ID查询" class="headerlink" title="用ID查询"></a>用ID查询</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 不能用n.id。这里的ID是neo4j默认的</span><br><span class="line">match(n) where ID(n) = 21798 return n</span><br></pre></td></tr></table></figure>
<h2 id="模糊查询"><a href="#模糊查询" class="headerlink" title="模糊查询"></a>模糊查询</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">match(n) where n.label=~&apos;科*.&apos; return n</span><br></pre></td></tr></table></figure>
<h1 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h1><p>merge 语法可以对已经存在的节点做改变，对变化的部分会合并</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MERGE (m:Movie &#123; title:&quot;Cloud Atlas&quot; &#125;) ON CREATE SET m.released = 2012 RETURN m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 执行以下语句没效果，没有增加realeased属性。把on CREATE去掉就可以了。</span><br><span class="line">MERGE (m:Person &#123; person_id:&quot;111&quot; &#125;) ON CREATE SET m.released = 2012 RETURN m</span><br><span class="line"></span><br><span class="line">MERGE (m:Person &#123; person_id:&quot;111&quot; &#125;) SET m.released = 2012 RETURN m</span><br></pre></td></tr></table></figure>
<p>merge …. on create set … return 语法支持合并更新</p>
<h2 id="更新属性"><a href="#更新属性" class="headerlink" title="更新属性"></a>更新属性</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">match(n) where ID(n) = 21798 set n.label=&apos;科比&apos;,n.height=198,n.position=&apos;得分后卫&apos; return n</span><br></pre></td></tr></table></figure>
<h2 id="修改关系属性"><a href="#修改关系属性" class="headerlink" title="修改关系属性"></a>修改关系属性</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">match(n)-[r]-(b) where ID(r) = 12513 set r.des=&apos;小飞侠&amp;大鲨鱼&apos; </span><br><span class="line">return n,r,b</span><br></pre></td></tr></table></figure>
<h2 id="删除属性"><a href="#删除属性" class="headerlink" title="删除属性"></a>删除属性</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">match(n) where ID(n) = 21798 remove n.height return n</span><br></pre></td></tr></table></figure>
<h2 id="删除节点"><a href="#删除节点" class="headerlink" title="删除节点"></a>删除节点</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">match(n:洛杉矶湖人) where ID(n) = 21836 delete n</span><br></pre></td></tr></table></figure>
<h2 id="删除关系"><a href="#删除关系" class="headerlink" title="删除关系"></a>删除关系</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">match(n)-[r]-(b) where n.label=&apos;科比&apos; and b.label=&apos;奥尼尔&apos;</span><br><span class="line">delete r</span><br><span class="line">return r</span><br></pre></td></tr></table></figure>
<h2 id="现有节点创建关系"><a href="#现有节点创建关系" class="headerlink" title="现有节点创建关系"></a>现有节点创建关系</h2><p><a href="https://www.quackit.com/neo4j/tutorial/neo4j_create_a_relationship_using_cypher.cfm" target="_blank" rel="noopener">https://www.quackit.com/neo4j/tutorial/neo4j_create_a_relationship_using_cypher.cfm</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MATCH (a:APP),(b:Person)</span><br><span class="line">WHERE a.app_code = &quot;F19999&quot; AND b.person_id = &quot;113&quot;</span><br><span class="line">CREATE (a)-[r:app_person]-&gt;(b)</span><br><span class="line">RETURN r</span><br></pre></td></tr></table></figure>
<h2 id="多个关系的创建"><a href="#多个关系的创建" class="headerlink" title="多个关系的创建"></a>多个关系的创建</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MATCH (a:Artist),(b:Album),(p:Person)</span><br><span class="line">WHERE a.Name = &quot;Strapping Young Lad&quot; AND b.Name = &quot;Heavy as a Really Heavy Thing&quot; AND p.Name = &quot;Devin Townsend&quot; </span><br><span class="line">CREATE (p)-[pr:PRODUCED]-&gt;(b), (p)-[pf:PERFORMED_ON]-&gt;(b), (p)-[pl:PLAYS_IN]-&gt;(a)</span><br><span class="line">RETURN a,b,p</span><br></pre></td></tr></table></figure>
<h2 id="筛选过滤"><a href="#筛选过滤" class="headerlink" title="筛选过滤"></a>筛选过滤</h2><p>cypher过滤也是用的和SQL一样的关键词where</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">match (p1: Person) where p1.name=&quot;sun&quot; return p1;</span><br></pre></td></tr></table></figure>
<p>等同下面的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">match (p1: Person &#123;name:&quot;sun&quot;&#125;) return p1</span><br></pre></td></tr></table></figure>
<p>注意where条件里面支持 and ， or ，xor，not等boolean运算符，在json串里面都是and</p>
<p>除此之外，where里面查询还支持<strong>正则查询</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">match (p1: Person)-[r:friend]-&gt;(p2: Person)</span><br><span class="line">where p1.name=~&quot;K.+&quot; or p2.age=24 or &quot;neo&quot; in r.rels</span><br><span class="line">return p1,r,p2</span><br></pre></td></tr></table></figure>
<p>关系过滤匹配使用not</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MATCH (p:Person)-[:ACTED_IN]-&gt;(m) WHERE NOT (p)-[:DIRECTED]-&gt;() RETURN p,m</span><br></pre></td></tr></table></figure>
<h2 id="结果集返回"><a href="#结果集返回" class="headerlink" title="结果集返回"></a>结果集返回</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 结果集返回做去重</span><br><span class="line">MATCH (p:Person) RETURN p, p.name AS name, upper(p.name), coalesce(p.nickname,&quot;n/a&quot;) AS nickname, &#123; name: p.name, label:head(labels(p))&#125; AS person</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">match (n) return distinct n.name;</span><br></pre></td></tr></table></figure>
<h2 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h2><p>cypher支持count,sum,avg,min,max</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">match (: Person) return count(*)</span><br></pre></td></tr></table></figure>
<p>聚合的时候null会被跳过 count 语法 支持 count( distinct role )</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MATCH (actor:Person)-[:ACTED_IN]-&gt;(movie:Movie)&lt;-[:DIRECTED]-(director:Person)RETURN actor,director,count(*) AS collaborations</span><br></pre></td></tr></table></figure>
<h2 id="排序和分页"><a href="#排序和分页" class="headerlink" title="排序和分页"></a>排序和分页</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MATCH (a:Person)-[:ACTED_IN]-&gt;(m:Movie) RETURN a,count() AS appearances ORDER BY appearances DESC SKIP 3 LIMIT 10;</span><br></pre></td></tr></table></figure>
<h2 id="收集聚合结果"><a href="#收集聚合结果" class="headerlink" title="收集聚合结果"></a>收集聚合结果</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MATCH (m:Movie)&lt;-[:ACTED_IN]-(a:Person)</span><br><span class="line">RETURN m.title AS movie, collect(a.name) AS cast, count(*) AS actors</span><br></pre></td></tr></table></figure>
<h2 id="union-联合"><a href="#union-联合" class="headerlink" title="union 联合"></a>union 联合</h2><p>支持两个查询结构集一样的结果合并</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MATCH (actor:Person)-[r:ACTED_IN]-&gt;(movie:Movie)</span><br><span class="line">RETURN actor.name AS name, type(r) AS acted_in, movie.title AS title</span><br><span class="line">UNION （ALL）</span><br><span class="line">MATCH (director:Person)-[r:DIRECTED]-&gt;(movie:Movie)</span><br><span class="line">RETURN director.name AS name, type(r) AS acted_in, movie.title AS title</span><br></pre></td></tr></table></figure>
<h2 id="with"><a href="#with" class="headerlink" title="with"></a>with</h2><p>with语句给cypher提供了强大的pipeline能力，可以一个或者query的输出，或者下一个query的输入 和return语句非常类似，唯一不同的是，with的每一个结果，必须使用别名标识。</p>
<p>通过这个功能，我们可以轻而易举的做到在查询结果里面在继续嵌套查询。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MATCH (person:Person)-[:ACTED_IN]-&gt;(m:Movie)</span><br><span class="line">WITH person, count(*) AS appearances, collect(m.title) AS movies</span><br><span class="line">WHERE appearances &gt; 1 RETURN person.name, appearances, movies</span><br></pre></td></tr></table></figure>
<p>注意在SQL里面，我们想过滤聚合结果，需要使用having语句但是在cypher里面我们可以配合with语句使用 where关键词来完成过滤</p>
<h2 id="添加约束或者索引"><a href="#添加约束或者索引" class="headerlink" title="添加约束或者索引"></a>添加约束或者索引</h2><p>唯一约束(使用merge来实现) </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE CONSTRAINT ON (movie:Movie) ASSERT movie.title IS UNIQUE</span><br></pre></td></tr></table></figure>
<p>添加索引(在图谱遍历时，快速找到开始节点),大幅提高查询遍历性能 CREATE INDEX ON :Actor(name)</p>
<p>添加测试数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE (actor:Actor &#123; name:&quot;Tom Hanks&quot; &#125;),(movie:Movie &#123; title:‘Sleepless IN Seattle‘ &#125;),</span><br><span class="line">(actor)-[:ACTED_IN]-&gt;(movie);</span><br></pre></td></tr></table></figure>
<p>使用索引查询:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MATCH (actor:Actor &#123; name: &quot;Tom Hanks&quot; &#125;) RETURN actor;</span><br></pre></td></tr></table></figure>
<h1 id="地理信息"><a href="#地理信息" class="headerlink" title="地理信息"></a>地理信息</h1><p>转自：<a href="http://neo4j.com.cn/topic/5b0be3179662eee704f31db6" target="_blank" rel="noopener">neo4j 3.4根据经纬度计算两点之间的距离</a></p>
<p><a href="https://neo4j.com/docs/developer-manual/current/cypher/functions/spatial/" target="_blank" rel="noopener">https://neo4j.com/docs/developer-manual/current/cypher/functions/spatial/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">create(l:Location) set l.latitude=toFloat(&apos;55.612151&apos;),l.longitude=toFloat(&apos;12.995090&apos;) return l</span><br><span class="line"></span><br><span class="line">with point(&#123;latitude:55.612,longitude:12.995&#125;) as poi</span><br><span class="line">match (l:Location) where l.latitude=55.612151</span><br><span class="line">return distance(point(&#123;latitude:l.latitude,longitude: l.longitude&#125;),poi) as distince</span><br><span class="line"></span><br><span class="line">with point(&#123;latitude:55.612,longitude:12.995&#125;) as poi</span><br><span class="line">match (l:Location) where l.latitude=55.612151 and distance(point(&#123;latitude:l.latitude,longitude: l.longitude&#125;),poi)&lt;20</span><br><span class="line">return distance(point(&#123;latitude:l.latitude,longitude: l.longitude&#125;),poi) as distince</span><br></pre></td></tr></table></figure>
<p>cypher 实现， 节点上存lat，lng属性，我用cypher重写了 谷歌的 地理位置距离算法，你可以在cypher的where语句里，用下面方法来找 500米以内的 节点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// cypher有自带的，目前应该用不到下面的</span><br><span class="line">round( </span><br><span class="line"> 6378.137 *1000*2*</span><br><span class="line">  asin(sqrt(</span><br><span class="line">       sin((radians(start.lat)-radians(&#123;start_lat&#125;))/2)^2+cos(radians(start.lat))*cos(radians(&#123;start_lat&#125;))* </span><br><span class="line">      sin((radians(start.lng)-radians(&#123;start_lng&#125;))/2)^2</span><br><span class="line">    ))</span><br><span class="line">   )&lt;500</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/32/">32</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Schwimmer</p>
              <div class="site-description motion-element" itemprop="description">Record and Think!</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">314</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">25</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">62</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Schwimmer</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.2.0</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="post-meta-divider">|</span>
  

  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="总访问量">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    
      <div>
        
  <script>
    window._bd_share_config = {
      "common": {
        "bdText": "",
        "bdMini": "1",
        "bdMiniList": false,
        "bdPic": ""
      },
      "image": {
        "viewList": ["tsina", "douban", "sqq", "qzone", "weixin", "twi", "fbook"],
        "viewText": "分享到：",
        "viewSize": "16"
      },
      "slide": {
        "bdImg": "5",
        "bdPos": "left",
        "bdTop": "100"
      }
    }
  </script>

<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

      </div>
    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.2.0"></script>

  <script src="/js/motion.js?v=7.2.0"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.2.0"></script>




  

  


  <script src="/js/next-boot.js?v=7.2.0"></script>


  

  

  

  
  
<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://https-schwimmer-github-io.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>







  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
  

  
  
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  

  
    
      <script type="text/x-mathjax-config">
  

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });
  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') { next = next.nextSibling }
        if (next && next.nodeName.toLowerCase() === 'br') { next.parentNode.removeChild(next) }
      }
    });
  });
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      document.getElementById(all[i].inputID + '-Frame').parentNode.className += ' has-jax';
    }
  });
</script>
<script src="//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->

    
  


  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
