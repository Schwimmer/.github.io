<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-CN">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222"/>






















<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0"/>

<link rel="stylesheet" href="/css/main.css?v=7.2.0"/>


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.2.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.2.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Record and Think!">
<meta property="og:type" content="website">
<meta property="og:title" content="Schwimmer&#39;s Blog">
<meta property="og:url" content="https://schwimmer.github.io/index.html">
<meta property="og:site_name" content="Schwimmer&#39;s Blog">
<meta property="og:description" content="Record and Think!">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Schwimmer&#39;s Blog">
<meta name="twitter:description" content="Record and Think!">





  
  
  <link rel="canonical" href="https://schwimmer.github.io/"/>



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Schwimmer's Blog</title>
  




  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-143240576-1"></script>
  <script>
    var host = window.location.hostname;
    if (host !== "localhost" || !true) {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-143240576-1');
    }
  </script>









  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Schwimmer's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">

    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br/>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br/>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br/>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br/>归档</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://schwimmer.github.io/2019/07/03/机器学习/知识图谱/Neo4j备份方式/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Schwimmer"/>
      <meta itemprop="description" content="Record and Think!"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schwimmer's Blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/03/机器学习/知识图谱/Neo4j备份方式/" class="post-title-link" itemprop="url">未命名</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-03 09:22:01 / 修改时间：09:22:21" itemprop="dateCreated datePublished" datetime="2019-07-03T09:22:01+08:00">2019-07-03</time>
            </span>
          

          
            

            
          

          

          
            
            
              
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/07/03/机器学习/知识图谱/Neo4j备份方式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/07/03/机器学习/知识图谱/Neo4j备份方式/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          <br/>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>Neo4j 企业版提供了一个在线备份（完整备份和增量备份）功能。</li>
</ul>
<p>社区版不知道</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://schwimmer.github.io/2019/07/03/机器学习/知识图谱/Neo4j单向和双向关系/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Schwimmer"/>
      <meta itemprop="description" content="Record and Think!"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schwimmer's Blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/03/机器学习/知识图谱/Neo4j单向和双向关系/" class="post-title-link" itemprop="url">未命名</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-03 09:18:02 / 修改时间：09:18:45" itemprop="dateCreated datePublished" datetime="2019-07-03T09:18:02+08:00">2019-07-03</time>
            </span>
          

          
            

            
          

          

          
            
            
              
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/07/03/机器学习/知识图谱/Neo4j单向和双向关系/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/07/03/机器学习/知识图谱/Neo4j单向和双向关系/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          <br/>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://www.jianshu.com/p/a25a1907b926" target="_blank" rel="noopener">https://www.jianshu.com/p/a25a1907b926</a></p>
<p>Neo4j的API允许开发人员在查询的时候<strong>完全忽略关系的方向</strong></p>
<p>比如，在Neo4j的查询语言Cypher中，查询Neo Technology的全部合作公司的语句可以大致如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">MATCH (neo)-[:PARTNER]-(partner)</div></pre></td></tr></table></figure>
<p>查询结果会和下面两条语句执行并合并后的结果完全一致：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">MATCH (neo)-[:PARTNER]-&gt;(partner)</div><div class="line">and MATCH (neo)&lt;-[:PARTNER]-(partner)</div></pre></td></tr></table></figure>
<p>因此，构建合作关系<strong>正确</strong>（至少是最有效）的方式就是用一个<strong>单向的关系</strong>，而且<strong>方向可以任意</strong>。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://schwimmer.github.io/2019/07/02/机器学习/知识图谱/图数据库Neo4j实现人脉推荐——二度人脉/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Schwimmer"/>
      <meta itemprop="description" content="Record and Think!"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schwimmer's Blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/02/机器学习/知识图谱/图数据库Neo4j实现人脉推荐——二度人脉/" class="post-title-link" itemprop="url">未命名</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-02 18:14:31" itemprop="dateCreated datePublished" datetime="2019-07-02T18:14:31+08:00">2019-07-02</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-03 09:46:16" itemprop="dateModified" datetime="2019-07-03T09:46:16+08:00">2019-07-03</time>
              </span>
            
          

          

          
            
            
              
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/07/02/机器学习/知识图谱/图数据库Neo4j实现人脉推荐——二度人脉/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/07/02/机器学习/知识图谱/图数据库Neo4j实现人脉推荐——二度人脉/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          <br/>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://blog.csdn.net/LoveJavaYDJ/article/details/53491346" target="_blank" rel="noopener">https://blog.csdn.net/LoveJavaYDJ/article/details/53491346</a></p>
<p>业务需求：<br>通过现有系统“好友关系”和“用户通讯录”数据，实现人脉推荐——二度人脉….六度人脉</p>
<p>技术实现分析：<br>关系数据库（深度关联表,算死人）<br>图数据库（天然图关系，选择Neo4j）<br>业务实体模型及规模 ：<br>实体——顶点：用户（数百万）、手机号码（数亿）<br>关系——边：好友双向关系（数亿）、手机属于某个注册用户（数百万）、用户拥有手机号码（数亿）</p>
<p>事例(Neo4j中只存储关系相关数据)：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">CREATE (p1:Person &#123;uid:122622,identityType:1,personIUCode:&apos;0101&apos;&#125;)</div><div class="line">CREATE (p2:Person &#123;uid:122623,identityType:1,personIUCode:&apos;0201&apos;&#125;)</div><div class="line">CREATE (p3:Person &#123;uid:122624,identityType:2,personIUCode:&apos;0301&apos;&#125;)</div><div class="line"></div><div class="line">CREATE (m1:Mobile &#123;num:&apos;1580084xxxx&apos;&#125;)</div><div class="line">CREATE (m2:Mobile &#123;num:&apos;1680084xxxx&apos;&#125;)</div><div class="line">CREATE (m3:Mobile &#123;num:&apos;1780084xxxx&apos;&#125;)</div><div class="line"></div><div class="line">CREATE</div><div class="line">  /*p1分别和p2、p3互为双向好友/ </div><div class="line">  (p1)-[:Fellow]-&gt;(p2),</div><div class="line">  (p2)-[:Fellow]-&gt;(p1),</div><div class="line"></div><div class="line">  (p1)-[:Fellow]-&gt;(p3),</div><div class="line">  (p3)-[:Fellow]-&gt;(p1),</div><div class="line"></div><div class="line">  /*用户p1通讯录中有m1、m2、m3三个联系人/</div><div class="line">  (p1)-[:Has]-&gt;(m1),</div><div class="line">  (p1)-[:Has]-&gt;(m2),</div><div class="line">  (p1)-[:Has]-&gt;(m3),</div><div class="line"></div><div class="line">  (p2)-[:Has]-&gt;(m3),</div><div class="line"></div><div class="line">  /*用户p1使用手机m1注册/</div><div class="line">  (m1)-[:Belong]-&gt;(p1)</div></pre></td></tr></table></figure>
<h2 id="实施方案-amp-计划："><a href="#实施方案-amp-计划：" class="headerlink" title="实施方案&amp;计划："></a>实施方案&amp;计划：</h2><p>第一数据：</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://schwimmer.github.io/2019/07/02/hadoop-spark/spark/Spark SQL中Join常用的几种实现/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Schwimmer"/>
      <meta itemprop="description" content="Record and Think!"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schwimmer's Blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/02/hadoop-spark/spark/Spark SQL中Join常用的几种实现/" class="post-title-link" itemprop="url">未命名</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-02 09:41:56 / 修改时间：09:49:35" itemprop="dateCreated datePublished" datetime="2019-07-02T09:41:56+08:00">2019-07-02</time>
            </span>
          

          
            

            
          

          

          
            
            
              
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/07/02/hadoop-spark/spark/Spark SQL中Join常用的几种实现/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/07/02/hadoop-spark/spark/Spark SQL中Join常用的几种实现/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          <br/>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://www.iteblog.com/archives/2086.html" target="_blank" rel="noopener">https://www.iteblog.com/archives/2086.html</a></p>
<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>Join是SQL语句中的常用操作，良好的表结构能够将数据分散在不同的表中，使其符合某种范式，减少表冗余、更新容错等。而建立表和表之间关系的最佳方式就是Join操作。</p>
<p><a href="https://www.iteblog.com/archives/tag/spark/" target="_blank" rel="noopener">Spark</a>SQL作为大数据领域的SQL实现，自然也对Join操作做了不少优化，今天主要看一下在<a href="https://www.iteblog.com/archives/tag/spark/" target="_blank" rel="noopener">Spark</a>SQL中对于Join，常见的3种实现。</p>
<h2 id="Spark-SQL中Join常用的实现"><a href="#Spark-SQL中Join常用的实现" class="headerlink" title="Spark SQL中Join常用的实现"></a><a href="https://www.iteblog.com/archives/tag/spark/" target="_blank" rel="noopener">Spark</a> SQL中Join常用的实现</h2><h3 id="Broadcast-Join"><a href="#Broadcast-Join" class="headerlink" title="Broadcast Join"></a>Broadcast Join</h3><p>大家知道，在数据库的常见模型中（比如星型模型或者雪花模型），表一般分为两种：事实表和维度表。维度表一般指固定的、变动较少的表，例如联系人、物品种类等，一般数据有限。而事实表一般记录流水，比如销售清单等，通常随着时间的增长不断膨胀。</p>
<p>因为Join操作是对两个表中key值相同的记录进行连接，在SparkSQL中，对两个表做Join最直接的方式是先根据key分区，再在每个分区中把key值相同的记录拿出来做连接操作。但这样就不可避免地涉及到shuffle，而shuffle在Spark中是比较耗时的操作，我们应该尽可能的设计Spark应用使其避免大量的shuffle。</p>
<p>当维度表和事实表进行Join操作时，为了避免shuffle，我们可以将大小有限的维度表的全部数据分发到每个节点上，供事实表使用。executor存储维度表的全部数据，一定程度上牺牲了空间，换取shuffle操作大量的耗时，这在SparkSQL中称作Broadcast Join，如下图所示：</p>
<p><a href="https://s.iteblog.com/pic/Spark_sql_broadcast_Join_iteblog.png" target="_blank" rel="noopener"><img src="/2019/07/02/hadoop-spark/spark/Spark SQL中Join常用的几种实现/pic/Spark_sql_broadcast_Join_iteblog.png" alt="Broadcast Join in Apache Spark sql"></a><br>如果想及时了解Spark、Hadoop或者Hbase相关的文章，欢迎关注微信公共帐号：<strong>iteblog_hadoop</strong></p>
<p>Table B是较小的表，黑色表示将其广播到每个executor节点上，Table A的每个partition会通过block manager取到Table A的数据。根据每条记录的Join Key取到Table B中相对应的记录，根据Join Type进行操作。这个过程比较简单，不做赘述。</p>
<p>Broadcast Join的条件有以下几个：</p>
<ul>
<li>被广播的表需要小于 <code>spark.sql.autoBroadcastJoinThreshold</code> 所配置的值，默认是10M （或者加了broadcast join的hint）</li>
<li>基表不能被广播，比如 left outer join 时，只能广播左表</li>
</ul>
<p>看起来广播是一个比较理想的方案，但它有没有缺点呢？也很明显。这个方案只能用于广播较小的表，否则数据的冗余传输就远大于shuffle的开销；另外，广播时需要将被广播的表现collect到driver端，当频繁有广播出现时，对driver的内存也是一个考验。</p>
<h3 id="Shuffle-Hash-Join"><a href="#Shuffle-Hash-Join" class="headerlink" title="Shuffle Hash Join"></a>Shuffle Hash Join</h3><p>当一侧的表比较小时，我们选择将其广播出去以避免shuffle，提高性能。但因为被广播的表首先被collect到driver段，然后被冗余分发到每个executor上，所以当表比较大时，采用broadcast join会对driver端和executor端造成较大的压力。</p>
<p>但由于Spark是一个分布式的计算引擎，可以通过分区的形式将大批量的数据划分成n份较小的数据集进行并行计算。这种思想应用到Join上便是Shuffle Hash Join了。利用key相同必然分区相同的这个原理，SparkSQL将较大表的join分而治之，先将表划分成n个分区，再对两个表中相对应分区的数据分别进行Hash Join，这样即在一定程度上减少了driver广播一侧表的压力，也减少了executor端取整张被广播表的内存消耗。其原理如下图：</p>
<p><a href="https://s.iteblog.com/pic/Spark_sql_Shuffle_Hash_Join_iteblog.png" target="_blank" rel="noopener"><img src="/2019/07/02/hadoop-spark/spark/Spark SQL中Join常用的几种实现/pic/Spark_sql_Shuffle_Hash_Join_iteblog.png" alt="Shuffle Hash Join in Apache Spark sql"></a><br>如果想及时了解Spark、Hadoop或者Hbase相关的文章，欢迎关注微信公共帐号：<strong>iteblog_hadoop</strong></p>
<p>Shuffle Hash Join分为两步：</p>
<ul>
<li>对两张表分别按照join keys进行重分区，即shuffle，目的是为了让有相同join keys值的记录分到对应的分区中</li>
<li>对对应分区中的数据进行join，此处先将小表分区构造为一张hash表，然后根据大表分区中记录的join keys值拿出来进行匹配</li>
</ul>
<p>Shuffle Hash Join的条件有以下几个：</p>
<ul>
<li>分区的平均大小不超过spark.sql.autoBroadcastJoinThreshold所配置的值，默认是10M</li>
<li>基表不能被广播，比如left outer join时，只能广播右表</li>
<li>一侧的表要明显小于另外一侧，小的一侧将被广播（明显小于的定义为3倍小，此处为经验值）</li>
</ul>
<p>我们可以看到，在一定大小的表中，SparkSQL从时空结合的角度来看，将两个表进行重新分区，并且对小表中的分区进行hash化，从而完成join。在保持一定复杂度的基础上，尽量减少driver和executor的内存压力，提升了计算时的稳定性。</p>
<h3 id="Sort-Merge-Join"><a href="#Sort-Merge-Join" class="headerlink" title="Sort Merge Join"></a>Sort Merge Join</h3><p>上面介绍的两种实现对于一定大小的表比较适用，但当两个表都非常大时，显然无论适用哪种都会对计算内存造成很大压力。这是因为join时两者采取的都是hash join，是将一侧的数据完全加载到内存中，使用hash code取join keys值相等的记录进行连接。</p>
<p>当两个表都非常大时，SparkSQL采用了一种全新的方案来对表进行Join，即Sort Merge Join。这种实现方式不用将一侧数据全部加载后再进星hash join，但需要在join前将数据排序，如下图所示：</p>
<p><a href="https://s.iteblog.com/pic/Spark_sql_Sort_Merge_Join_iteblog.png" target="_blank" rel="noopener"><img src="/2019/07/02/hadoop-spark/spark/Spark SQL中Join常用的几种实现/pic/Spark_sql_Sort_Merge_Join_iteblog.png" alt="Sort Merge Join in Apache Spark sql"></a><br>如果想及时了解Spark、Hadoop或者Hbase相关的文章，欢迎关注微信公共帐号：<strong>iteblog_hadoop</strong></p>
<p>可以看到，首先将两张表按照join keys进行了重新shuffle，保证join keys值相同的记录会被分在相应的分区。分区后对每个分区内的数据进行排序，排序后再对相应的分区内的记录进行连接，如下图示：</p>
<p><a href="https://s.iteblog.com/pic/Spark_sql_Sort_Merge_Join_example_iteblog.png" target="_blank" rel="noopener"><img src="/2019/07/02/hadoop-spark/spark/Spark SQL中Join常用的几种实现/pic/Spark_sql_Sort_Merge_Join_example_iteblog.png" alt="Sort Merge Join in Apache Spark sql"></a><br>如果想及时了解Spark、Hadoop或者Hbase相关的文章，欢迎关注微信公共帐号：<strong>iteblog_hadoop</strong></p>
<p>看着很眼熟吧？也很简单，因为两个序列都是有序的，从头遍历，碰到key相同的就输出；如果不同，左边小就继续取左边，反之取右边。</p>
<p>可以看出，无论分区有多大，Sort Merge Join都不用把某一侧的数据全部加载到内存中，而是即用即取即丢，从而大大提升了大数据量下sql join的稳定性。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文介绍了SparkSQL中的3中Join实现，其实这也不是什么新鲜玩意儿。传统DB也有这也的玩法儿，SparkSQL只是将其做成分布式的实现。</p>
<p>本文仅仅从大的理论方面介绍了这几种实现，具体到每个join type是怎么遍历、没有join keys时应该怎么做、这些实现对join keys有什么具体的需求，这些细节都没有展现出来。感兴趣的话，可以去翻翻源码。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://schwimmer.github.io/2019/07/01/总结与思考/面试问题-BI工程师/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Schwimmer"/>
      <meta itemprop="description" content="Record and Think!"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schwimmer's Blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/01/总结与思考/面试问题-BI工程师/" class="post-title-link" itemprop="url">未命名</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-01 13:59:19 / 修改时间：14:25:04" itemprop="dateCreated datePublished" datetime="2019-07-01T13:59:19+08:00">2019-07-01</time>
            </span>
          

          
            

            
          

          

          
            
            
              
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/07/01/总结与思考/面试问题-BI工程师/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/07/01/总结与思考/面试问题-BI工程师/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          <br/>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>数仓<br>1.请简单说一下过往做过的数据仓库项目，在仓库内部数据分层是如何做的，每层的目的都是什么，为何要按这种逻辑做分层。<br>2.星型模型和雪花模型的优劣各是什么？你日常是如何使用这两种模型的？<br>3.聊聊你对于数据监控的认知和实践经验？监控的目的？监控的逻辑？监控的手段？<br>4.任务调度工具使用过哪些，你觉得里面有没有什么不顺手的地方？如果需要改进，怎么改进？如何避免环状调度依赖？<br>9.说说你过往在做数据仓库过程中碰到的最大困难，你最终是是如何应对的？</p>
<p>hive<br>10、decimal做group by<br>11、锁表问题，如何解决<br>6、如果对任务资源做限制，用哪些参数？这些参数值调高调低的依据是什么<br>13、hive的数据倾斜问题。数据倾斜在任务执行时的表现是什么，你一般会从什么角度来排查数据倾斜的原因？</p>
<p>spark<br>12、spark常用的配置参数有哪些，设置某个参数值的依据是什么，如何验证你的设置<br>7.spark里，聊聊你常用的算子，哪些是Transformation类型，哪些是Action类型。<br>8.spark里，如果有一些变量要做全局告知或重复使用，该怎么做</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://schwimmer.github.io/2019/07/01/机器学习/知识图谱/安装配置/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Schwimmer"/>
      <meta itemprop="description" content="Record and Think!"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schwimmer's Blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/01/机器学习/知识图谱/安装配置/" class="post-title-link" itemprop="url">未命名</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-01 12:02:12 / 修改时间：12:02:57" itemprop="dateCreated datePublished" datetime="2019-07-01T12:02:12+08:00">2019-07-01</time>
            </span>
          

          
            

            
          

          

          
            
            
              
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/07/01/机器学习/知识图谱/安装配置/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/07/01/机器学习/知识图谱/安装配置/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          <br/>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Neo4j安装"><a href="#Neo4j安装" class="headerlink" title="Neo4j安装"></a>Neo4j安装</h1><p>下载地址<a href="https://neo4j.com/download-center/#releases" target="_blank" rel="noopener">https://neo4j.com/download-center/#releases</a></p>
<p>解压后，放在<code>/Users/david/david/neo4j-community-3.5.6</code></p>
<p>1、配置环境变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">export NEO4J_HOME=&quot;/Users/david/david/neo4j-community-3.5.6&quot;</div><div class="line">export PATH=&quot;$NEO4J_HOME/bin:$PATH&quot;</div></pre></td></tr></table></figure>
<p>2、启动服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">neo4j start</div></pre></td></tr></table></figure>
<p>3、浏览器访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://localhost:7474/browser/</div></pre></td></tr></table></figure>
<p>首次进入时用户名密码都是neo4j，然后会提示输入新密码，新密码是<code>123456</code></p>
<p>重启服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">neo4j restart</div></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://schwimmer.github.io/2019/07/01/机器学习/知识图谱/Neo4j使用方式/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Schwimmer"/>
      <meta itemprop="description" content="Record and Think!"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schwimmer's Blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/01/机器学习/知识图谱/Neo4j使用方式/" class="post-title-link" itemprop="url">未命名</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-01 11:55:18 / 修改时间：12:01:39" itemprop="dateCreated datePublished" datetime="2019-07-01T11:55:18+08:00">2019-07-01</time>
            </span>
          

          
            

            
          

          

          
            
            
              
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/07/01/机器学习/知识图谱/Neo4j使用方式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/07/01/机器学习/知识图谱/Neo4j使用方式/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          <br/>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="如何在neo4j中创建新数据库"><a href="#如何在neo4j中创建新数据库" class="headerlink" title="如何在neo4j中创建新数据库"></a>如何在neo4j中创建新数据库</h2><p>如图片中所示，默认的DB名称是<strong>Graph.db</strong>。</p>
<p><img src="/2019/07/01/机器学习/知识图谱/Neo4j使用方式/pic/image-20190701115547060.png" alt="image-20190701115547060"></p>
<p>在Neo4j的文档中</p>
<blockquote>
<p>Community Edition is a fully functional edition of Neo4j, suitable for single instance deployments. It has full support for key Neo4j features, such as ACID compliance, Cypher, and programming APIs. It is ideal for learning Neo4j, for do-it-yourself projects, and for applications in small workgroups.</p>
</blockquote>
<p>所以你只有一个数据库实例。</p>
<p>需在<code>$NEO4J_HOME</code>的<code>conf</code>的目录编辑<code>neo4j.conf</code>。</p>
<p>搜寻<code>dbms.active_database=</code>，其默认值应为<code>graph.db</code>。用其他名称替换它，然后再次启动neo4j。现在，将在该目录名下创建一个新数据库。若要切换回以前的db，请重复这些步骤，只需将新值替换为<code>graph.db</code>在配置文件中。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://schwimmer.github.io/2019/07/01/机器学习/知识图谱/如何将大规模数据导入Neo4j/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Schwimmer"/>
      <meta itemprop="description" content="Record and Think!"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schwimmer's Blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/01/机器学习/知识图谱/如何将大规模数据导入Neo4j/" class="post-title-link" itemprop="url">未命名</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-01 11:30:22 / 修改时间：11:30:50" itemprop="dateCreated datePublished" datetime="2019-07-01T11:30:22+08:00">2019-07-01</time>
            </span>
          

          
            

            
          

          

          
            
            
              
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/07/01/机器学习/知识图谱/如何将大规模数据导入Neo4j/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/07/01/机器学习/知识图谱/如何将大规模数据导入Neo4j/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          <br/>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://paradoxlife.me/how-to-insert-bulk-data-into-neo4j" target="_blank" rel="noopener">http://paradoxlife.me/how-to-insert-bulk-data-into-neo4j</a></p>
<p>项目需要基于Neo4j开发，由于数据量较大（数千万节点），因此对当前数据插入的方法进行了分析和对比。</p>
<h2 id="常见数据插入方式概览"><a href="#常见数据插入方式概览" class="headerlink" title="常见数据插入方式概览"></a>常见数据插入方式概览</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">Neo4j Version</th>
<th style="text-align:center">Language Driver</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Community 3.0.2</td>
<td style="text-align:center">Python <a href="http://neo4j.com/developer/python/" target="_blank" rel="noopener">neo4j-driver 1.0.0</a></td>
</tr>
</tbody>
</table>
</div>
<p>目前主要有以下几种数据插入方式：</p>
<ol>
<li>Cypher CREATE 语句，为每一条数据写一个CREATE</li>
<li>Cypher <a href="http://neo4j.com/developer/guide-import-csv/#_load_csv_for_medium_sized_datasets" target="_blank" rel="noopener">LOAD CSV</a> 语句，将数据转成CSV格式，通过LOAD CSV读取数据。</li>
<li>官方提供的Java API —— <a href="http://neo4j.com/docs/java-reference/current/javadocs/org/neo4j/unsafe/batchinsert/BatchInserter.html" target="_blank" rel="noopener">Batch Inserter</a></li>
<li>大牛编写的 <a href="https://github.com/jexp/batch-import/blob/2.3/readme.md" target="_blank" rel="noopener">Batch Import</a> 工具</li>
<li>官方提供的 <a href="http://neo4j.com/developer/guide-import-csv/#_super_fast_batch_importer_for_huge_datasets" target="_blank" rel="noopener">neo4j-import</a> 工具</li>
</ol>
<p>这些工具有什么不同呢？速度如何？适用的场景分别是什么？我这里根据我个人理解，粗略地给出了一个结果：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">CREATE语句</th>
<th style="text-align:center">LOAD CSV语句</th>
<th style="text-align:center">Batch Inserter</th>
<th style="text-align:center">Batch Import</th>
<th style="text-align:center">Neo4j-import</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">适用场景</td>
<td style="text-align:center">1 ~ 1w nodes</td>
<td style="text-align:center">1w ~ 10 w nodes</td>
<td style="text-align:center">千万以上 nodes</td>
<td style="text-align:center">千万以上 nodes</td>
<td style="text-align:center">千万以上 nodes</td>
</tr>
<tr>
<td style="text-align:center">速度</td>
<td style="text-align:center">很慢 (1000 nodes/s)</td>
<td style="text-align:center">一般 (5000 nodes/s)</td>
<td style="text-align:center">非常快 (数万 nodes/s)</td>
<td style="text-align:center">非常快 (数万 nodes/s)</td>
<td style="text-align:center">非常快 (数万 nodes/s)</td>
</tr>
<tr>
<td style="text-align:center">优点</td>
<td style="text-align:center">使用方便，可实时插入。</td>
<td style="text-align:center">使用方便，可以加载本地/远程CSV；可实时插入。</td>
<td style="text-align:center">速度相比于前两个，有数量级的提升</td>
<td style="text-align:center">基于Batch Inserter，可以直接运行编译好的jar包；<strong>可以在已存在的数据库中导入数据</strong></td>
<td style="text-align:center">官方出品，比Batch Import占用更少的资源</td>
</tr>
<tr>
<td style="text-align:center">缺点</td>
<td style="text-align:center">速度慢</td>
<td style="text-align:center">需要将数据转换成CSV</td>
<td style="text-align:center">需要转成CSV；<strong>只能在JAVA中使用</strong>；且插入时<strong>必须停止neo4j</strong></td>
<td style="text-align:center">需要转成CSV；<strong>必须停止neo4j</strong></td>
<td style="text-align:center">需要转成CSV；<strong>必须停止neo4j</strong>；<strong>只能生成新的数据库，而不能在已存在的数据库中插入数据。</strong></td>
</tr>
</tbody>
</table>
</div>
<h2 id="速度测试"><a href="#速度测试" class="headerlink" title="速度测试"></a>速度测试</h2><p>下面是我自己做的一些性能测试：</p>
<h3 id="1-CREATE-语句"><a href="#1-CREATE-语句" class="headerlink" title="1. CREATE 语句"></a>1. CREATE 语句</h3><p>这里每1000条进行一次Transaction提交</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CREATE (:label &#123;property1:value, property2:value, property3:value&#125; )</div></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">11.5w nodes</th>
<th style="text-align:center">18.5w nodes</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">100 s</td>
<td style="text-align:center">160 s</td>
</tr>
</tbody>
</table>
</div>
<h3 id="2-LOAD-CSV-语句"><a href="#2-LOAD-CSV-语句" class="headerlink" title="2. LOAD CSV 语句"></a>2. LOAD CSV 语句</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">using periodic commit 1000</div><div class="line">load csv from &quot;file:///fscapture_screencapture_syscall.csv&quot; as line</div><div class="line">create (:label &#123;a:line[1], b:line[2], c:line[3], d:line[4], e:line[5], f:line[6], g:line[7], h:line[8], i:line[9], j:line[10]&#125;)</div></pre></td></tr></table></figure>
<p>这里使用了语句USING PERIODIC COMMIT 1000，使得每1000行作为一次Transaction提交。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">11.5w nodes</th>
<th style="text-align:center">18.5w nodes</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">21 s</td>
<td style="text-align:center">39 s</td>
</tr>
</tbody>
</table>
</div>
<h3 id="3-Batch-Inserter、Batch-Import、Neo4j-import"><a href="#3-Batch-Inserter、Batch-Import、Neo4j-import" class="headerlink" title="3. Batch Inserter、Batch Import、Neo4j-import"></a>3. Batch Inserter、Batch Import、Neo4j-import</h3><p>我只测试了Neo4j-import，没有测试Batch Inserter和Batch Import，但是我估计他们的内部实现差不多，速度也处于一个数量级别上，因此这里就一概而论了。</p>
<p>neo4j-import需要在Neo4j所在服务器执行，因此服务器的资源影响数据导入的性能，我这里为JVM分配了16G的heap资源，确保性能达到最好。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo ./bin/neo4j-import --into graph.db --nodes:label path_to_csv.csv</div></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">11.5w nodes</th>
<th style="text-align:center">18.5w nodes</th>
<th style="text-align:center">150w nodes + 1431w edges</th>
<th style="text-align:center">3113w nodes + 7793w edges</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">3.4 s</td>
<td style="text-align:center">3.8 s</td>
<td style="text-align:center">26.5 s</td>
<td style="text-align:center">3 m 48 s</td>
</tr>
</tbody>
</table>
</div>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><ol>
<li>如果项目刚开始，想要将大量数据导入数据库，Neo4j-import是最好的选择。</li>
<li>如果数据库已经投入使用，并且可以容忍Neo4j关闭一段时间，那么Batch Import是最好的选择，当然如果你想自己实现，那么你应该选择Batch Inserter</li>
<li>如果数据库已经投入使用，且不能容忍Neo4j的临时关闭，那么LOAD CSV是最好的选择。</li>
<li>最后，如果只是想插入少量的数据，且不怎么在乎实时性，那么请直接看Cypher语言。</li>
</ol>
<h2 id="其它的Tips"><a href="#其它的Tips" class="headerlink" title="其它的Tips"></a>其它的Tips</h2><ol>
<li>在LOAD CSV前面加上USING PERIODIC COMMIT 1000，1000表示每1000行的数据进行一次Transaction提交，提升性能。</li>
<li><a href="http://jexp.de/blog/2015/04/on-neo4j-indexes-match-merge/" target="_blank" rel="noopener">建立index</a>可以使得查询性能得到巨大提升。如果不建立index，则需要对每个node的每一个属性进行遍历，所以比较慢。 并且index建立之后，新加入的数据都会自动编入到index中。 注意index是建立在label上的，不是在node上，所以一个node有多个label，需要对每一个label都建立index。</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://schwimmer.github.io/2019/06/29/机器学习/知识图谱/教程-电影数据/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Schwimmer"/>
      <meta itemprop="description" content="Record and Think!"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schwimmer's Blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/29/机器学习/知识图谱/教程-电影数据/" class="post-title-link" itemprop="url">未命名</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-06-29 18:38:13" itemprop="dateCreated datePublished" datetime="2019-06-29T18:38:13+08:00">2019-06-29</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-01 16:41:13" itemprop="dateModified" datetime="2019-07-01T16:41:13+08:00">2019-07-01</time>
              </span>
            
          

          

          
            
            
              
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/06/29/机器学习/知识图谱/教程-电影数据/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/06/29/机器学习/知识图谱/教程-电影数据/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          <br/>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="关于数据"><a href="#关于数据" class="headerlink" title="关于数据"></a>关于数据</h1><p>执行<code>/Users/david/david/code/neo4j/movie_sample/movie_data_import.sql</code></p>
<p>表格有</p>
<p><code>genre</code>电影类型和id</p>
<p><code>movie</code>每个电影数据</p>
<p><code>movie_to_genre</code>电影和类型的映射关系</p>
<p><code>person</code>电影演员信息</p>
<p><code>person_to_movie</code>电影演员和电影的映射关系</p>
<p>2、导出CSV</p>
<p>3、导入neo4j</p>
<p>neo4j的默认导入路径是<code>/Users/david/david/neo4j-community-3.5.6/import</code></p>
<p>把csv复制到这里。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">//导入节点 电影类型  == 注意类型转换</div><div class="line">LOAD CSV WITH HEADERS  FROM &quot;file:///genre.csv&quot; AS line</div><div class="line">MERGE (p:Genre&#123;gid:toInteger(line.gid),name:line.gname&#125;)</div><div class="line">	</div><div class="line"></div><div class="line">//导入节点 演员信息	</div><div class="line">LOAD CSV WITH HEADERS FROM &apos;file:///person.csv&apos; AS line</div><div class="line">MERGE (p:Person &#123; pid:toInteger(line.pid),birth:line.birth,</div><div class="line">death:line.death,name:line.name,engname:line.engname,</div><div class="line">biography:line.biography,</div><div class="line">birthplace:line.birthplace&#125;)</div><div class="line"></div><div class="line"></div><div class="line">// 导入节点 电影信息</div><div class="line">LOAD CSV WITH HEADERS  FROM &quot;file:///movie.csv&quot; AS line  </div><div class="line">MERGE (p:Movie&#123;mid:toInteger(line.mid),title:line.title,introduction:line.introduction,</div><div class="line">rating:toFloat(line.rating),releasedate:line.releasedate&#125;)</div><div class="line"></div><div class="line"></div><div class="line">// 导入关系 actedin  电影是谁参演的 1对多</div><div class="line">LOAD CSV WITH HEADERS FROM &quot;file:///person_to_movie.csv&quot; AS line </div><div class="line">match (from:Person&#123;pid:toInteger(line.pid)&#125;),(to:Movie&#123;mid:toInteger(line.mid)&#125;)  </div><div class="line">merge (from)-[r:actedin&#123;pid:toInteger(line.pid),mid:toInteger(line.mid)&#125;]-&gt;(to)</div><div class="line">	</div><div class="line">//导入关系  电影是什么类型 == 1对多</div><div class="line">LOAD CSV WITH HEADERS FROM &quot;file:///movie_to_genre.csv&quot; AS line</div><div class="line">match (from:Movie&#123;mid:toInteger(line.mid)&#125;),(to:Genre&#123;gid:toInteger(line.gid)&#125;)  </div><div class="line">merge (from)-[r:is&#123;mid:toInteger(line.mid),gid:toInteger(line.gid)&#125;]-&gt;(to)</div><div class="line"></div><div class="line"></div><div class="line">-- 问：章子怡都演了哪些电影？</div><div class="line">match(n:Person)-[:actedin]-&gt;(m:Movie) where n.name=&apos;章子怡&apos; return m.title</div><div class="line"></div><div class="line">--  删除所有的节点及关系</div><div class="line">MATCH (n)-[r]-(b)</div><div class="line">DELETE n,r,b</div></pre></td></tr></table></figure>
<p>导入时可能会报错</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Neo.ClientError.Statement.SemanticError: Cannot merge node using null property value for name</div></pre></td></tr></table></figure>
<p>可能是csv中这一列有空值，我的做法是把空值改成空格，解决。</p>
<h1 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h1><p>我们利用cypher语句查询一下关系actedin有哪些</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">match (n)-[r:actedin]-(b) return n,r,b limit 10</div></pre></td></tr></table></figure>
<p>参考：</p>
<p><a href="https://blog.csdn.net/Appleyk/article/details/80332911" target="_blank" rel="noopener">基于电影知识图谱的智能问答系统（二） — Neo4j导入CSV文件</a></p>
<p><a href="https://blog.csdn.net/appleyk/article/details/80331997" target="_blank" rel="noopener">基于电影知识图谱的智能问答系统（一） — Mysql数据准备</a></p>
<p><a href="https://blog.csdn.net/Appleyk/article/details/80334716" target="_blank" rel="noopener">基于电影知识图谱的智能问答系统（三） — Spark环境搭建</a></p>
<p><a href="https://blog.csdn.net/Appleyk/article/details/80335536" target="_blank" rel="noopener">基于电影知识图谱的智能问答系统（四） —HanLP分词器</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://schwimmer.github.io/2019/06/27/机器学习和深度学习算法理论/人脸识别/开源模型/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Schwimmer"/>
      <meta itemprop="description" content="Record and Think!"/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schwimmer's Blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/27/机器学习和深度学习算法理论/人脸识别/开源模型/" class="post-title-link" itemprop="url">未命名</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-06-27 09:27:07 / 修改时间：09:48:27" itemprop="dateCreated datePublished" datetime="2019-06-27T09:27:07+08:00">2019-06-27</time>
            </span>
          

          
            

            
          

          

          
            
            
              
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/06/27/机器学习和深度学习算法理论/人脸识别/开源模型/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/06/27/机器学习和深度学习算法理论/人脸识别/开源模型/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          <br/>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>人脸验证Face Identification  / Face Verification </p>
<p>查阅开源的人脸识别技术方案，暂定使用如下三种方案：</p>
<p>​      <a href="https://github.com/cmusatyalab/openface" target="_blank" rel="noopener">https://github.com/cmusatyalab/openface</a>             基于FaceNet- A Unified Embedding for Face Recognition and Clustering</p>
<p>​     <a href="https://github.com/ageitgey/face_recognition#face-recognition" target="_blank" rel="noopener">https://github.com/ageitgey/face_recognition#face-recognition</a></p>
<p>​      <a href="https://github.com/deepinsight/insightface" target="_blank" rel="noopener">https://github.com/deepinsight/insightface</a>           基于ArcFace: Additive Angular Margin Loss for Deep Face Recognition</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/32/">32</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Schwimmer</p>
              <div class="site-description motion-element" itemprop="description">Record and Think!</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">314</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">17</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">55</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Schwimmer</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.5.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.2.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.2.0"></script>

  <script src="/js/motion.js?v=7.2.0"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.2.0"></script>




  

  


  <script src="/js/next-boot.js?v=7.2.0"></script>


  

  

  

  
  
<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://https-schwimmer-github-io.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->







  




  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
